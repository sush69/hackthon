(function(g){var window=this;'use strict';var cvc=function(y){var q=new g.s1("und",new g.I8("Default","und",!0));q.captionTracks=y.captionTracks;return q},Uac=function(y){return new g.zD(function(q,Q){var p=y.length,v=[];
if(p)for(var d=function(J,F){p--;v[J]=F;p==0&&q(v)},T=function(J){Q(J)},O,w=0;w<y.length;w++)O=y[w],g.gb3(O,g.Yq(d,w),T);
else q(v)})},ui=function(y){this.K=y},I7=function(){ui.apply(this,arguments)},rvc=function(){I7.apply(this,arguments)},oU_=function(){I7.apply(this,arguments)},Av_=function(){I7.apply(this,arguments)},ebk=function(){I7.apply(this,arguments)},Brc=function(){I7.apply(this,arguments)},Gyh=function(){I7.apply(this,arguments)},Pmm=function(){I7.apply(this,arguments)},iYe=function(){ui.apply(this,arguments)},X2k=function(){I7.apply(this,arguments)},mam=function(){I7.apply(this,arguments)},Cmw=function(){I7.apply(this,
arguments)},yj_=function(){I7.apply(this,arguments)},qNe=function(){I7.apply(this,arguments)},j_m=function(){I7.apply(this,arguments)},Q_C=function(){I7.apply(this,arguments)},pP_=function(){I7.apply(this,arguments)},vKX=function(){I7.apply(this,arguments)},dSh=function(){I7.apply(this,arguments)},TDC=function(){I7.apply(this,arguments)},VPm=function(){I7.apply(this,arguments)},ORm=function(){ui.apply(this,arguments)},wPC=function(){I7.apply(this,arguments)},Jjq=function(){I7.apply(this,arguments)},
Fk_=function(){I7.apply(this,arguments)},YNe=function(){I7.apply(this,arguments)},f7G=function(){I7.apply(this,arguments)},hhX=function(){I7.apply(this,arguments)},bRu=function(){I7.apply(this,arguments)},$Sn=function(){I7.apply(this,arguments)},Kkm=function(){I7.apply(this,arguments)},xSm=function(){ui.apply(this,arguments)},Wkh=function(){ui.apply(this,arguments)},ZRG=function(){ui.apply(this,arguments)},tPm=function(){I7.apply(this,arguments)},EKn=function(){I7.apply(this,arguments)},keG=function(){I7.apply(this,
arguments)},Lkn=function(){I7.apply(this,arguments)},a7h=function(){I7.apply(this,arguments)},NDS=function(){I7.apply(this,arguments)},SNG=function(){I7.apply(this,arguments)},HRk=function(){I7.apply(this,arguments)},Rh_=function(){I7.apply(this,arguments)},s_q=function(){I7.apply(this,arguments)},MPu=function(){I7.apply(this,arguments)},l7k=function(){I7.apply(this,arguments)},zhm=function(){I7.apply(this,arguments)},DSw=function(){I7.apply(this,arguments)},uGX=function(){I7.apply(this,arguments)},
I7q=function(){I7.apply(this,arguments)},nKw=function(){I7.apply(this,arguments)},gKh=function(){I7.apply(this,arguments)},cjG=function(){I7.apply(this,arguments)},USc=function(){I7.apply(this,arguments)},rj_=function(){I7.apply(this,arguments)},oKw=function(){I7.apply(this,arguments)},Aj_=function(){I7.apply(this,arguments)},ehw=function(){I7.apply(this,arguments)},BD_=function(){I7.apply(this,arguments)},Geq=function(){I7.apply(this,arguments)},P3C=function(){I7.apply(this,arguments)},iRe=function(){ui.apply(this,
arguments)},XPm=function(){I7.apply(this,arguments)},mSw=function(){I7.apply(this,arguments)},C3k=function(){I7.apply(this,arguments)},y9h=function(){I7.apply(this,arguments)},qnm=function(){I7.apply(this,arguments)},jw_=function(){I7.apply(this,arguments)},Qww=function(){I7.apply(this,arguments)},pqh=function(){I7.apply(this,arguments)},vvm=function(){I7.apply(this,arguments)},dNc=function(){I7.apply(this,arguments)},Tom=function(){I7.apply(this,arguments)},Vtw=function(){I7.apply(this,arguments)},
Oye=function(){I7.apply(this,arguments)},wqG=function(){I7.apply(this,arguments)},J9X=function(){I7.apply(this,arguments)},Ffn=function(){I7.apply(this,arguments)},Yn_=function(){I7.apply(this,arguments)},fjc=function(){I7.apply(this,arguments)},hQG=function(){I7.apply(this,arguments)},bye=function(){I7.apply(this,arguments)},$N_=function(){I7.apply(this,arguments)},Kf_=function(){I7.apply(this,arguments)},xNh=function(){I7.apply(this,arguments)},WfS=function(){I7.apply(this,arguments)},ZyS=function(){I7.apply(this,
arguments)},ttu=function(){I7.apply(this,arguments)},Evn=function(){I7.apply(this,arguments)},kDw=function(){I7.apply(this,arguments)},LfG=function(){I7.apply(this,arguments)},aj_=function(){I7.apply(this,arguments)},Non=function(){I7.apply(this,arguments)},Sn_=function(){I7.apply(this,arguments)},Hym=function(){I7.apply(this,arguments)},RQm=function(){I7.apply(this,arguments)},sww=function(y){y=y.key||y.id;
if(!y)throw Error("Entity key is missing");return y},MtC=function(){if(ne)return ne();
var y={};ne=g.jB("PersistentEntityStoreDb",{tG:(y.EntityStore={qX:1},y.EntityAssociationStore={qX:2},y),shared:!1,upgrade:function(q,Q){Q(1)&&g.Ik(g.sf(q,"EntityStore",{keyPath:"key"}),"entityType","entityType");Q(2)&&(q=g.sf(q,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Ik(q,"byParentEntityKey","parentEntityKey"),g.Ik(q,"byChildEntityKey","childEntityKey"))},
version:3});return ne()},ljc=function(y){return g.eK(MtC(),y)},zQS=function(y){return g.eK((0,g.Y2S)(),y)},g8=function(y){this.token=y},c7=function(y,q){q=q===void 0?{}:q;
g.GH.call(this,g.fn_[y],Object.assign({},{name:"PESEncoderError",type:y},q));this.type=y;this.level="WARNING";Object.setPrototypeOf(this,c7.prototype)},DNC=function(y){return new c7("WRONG_DATA_TYPE",{lZ:y})},uOq=function(y){return y instanceof Error?new c7("UNKNOWN_ENCODE_ERROR",{originalMessage:y.message}):new c7("UNKNOWN_ENCODE_ERROR")},Ijm=function(y){return y instanceof Error?new c7("UNKNOWN_DECODE_ERROR",{originalMessage:y.message}):new c7("UNKNOWN_DECODE_ERROR")},nvq=function(y,q){y=y instanceof
c7?y:q(y);
g.l$(y);throw y;},gvu=function(){},c9_=function(y,q,Q){try{return y.N(q,Q)}catch(p){nvq(p,uOq)}},UNc=function(y){y=(new TextEncoder).encode(y).subarray(0,16);
var q=new Uint8Array(16);q.set(y);return q},UO=function(y){this.K=y},ovh=function(y){var q=r9S[y];
if(q)return q;g.zI(new g.GH("Entity model not found.",{entityType:y}))},A9S=function(y,q){this.K=y;
this.W=q;this.N={}},Boh=function(y,q){a:{y=eQ_(y.W,q.version);
try{var Q=y.W(q.data,q.key);break a}catch(p){nvq(p,Ijm)}Q=void 0}return Q},r8=function(y,q,Q){return y.K.objectStore("EntityStore").get(q).then(function(p){if(p){if(Q&&p.entityType!==Q)throw Error("Incorrect entity type");
return Boh(y,p)}})},o7=function(y,q,Q){return Q?(Q=Q.map(function(p){return r8(y,p,q)}),g.kC.all(Q)):y.K.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(q)).then(function(p){return p.map(function(v){return Boh(y,v)})})},eq=function(y,q,Q){var p=sww(q),v=eQ_(y.W,1),d=Object.assign({},q);
return y.K.objectStore("EntityStore").get(p).then(function(T){if(T){if(T.entityType!==Q)throw Error("Incorrect entity type");d.entityMetadata||(T=Boh(y,T),d.entityMetadata=T.entityMetadata)}}).then(function(){var T={key:p,
entityType:Q,data:c9_(v,d,p),version:1};return g.kC.all([g.z3(y.K.objectStore("EntityStore"),T),GDX(y,d,Q)])}).then(function(){AE(y,p,Q);
return p})},Pun=function(y,q,Q){q=q.map(function(p){return eq(y,p,Q)});
return g.kC.all(q)},B7=function(y,q,Q){if(Q==null?0:Q.PD){var p=new Set;
return iyw(y,q,p).then(function(){for(var d=[],T=g.t(p),O=T.next();!O.done;O=T.next())d.push(B7(y,O.value));return g.kC.all(d).then(function(){})})}var v=g.QX(q).entityType;
return g.kC.all([y.K.objectStore("EntityStore").delete(q),Xqq(y,q)]).then(function(){AE(y,q,v)})},mNk=function(y,q){return g.Uf(y.K.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(q)},function(Q){return g.kC.all([Q.delete(),
Xqq(y,Q.cursor.primaryKey)]).then(function(){AE(y,Q.cursor.primaryKey,q);return g.gU(Q)})})},Cuu=function(y,q,Q,p){var v=eQ_(y.W,1);
return r8(y,q,p).then(function(d){if(d){d=g.J0(d,Q);var T={key:q,entityType:p,data:c9_(v,d,q),version:1};return g.kC.all([g.z3(y.K.objectStore("EntityStore"),T),GDX(y,d,p)])}}).then(function(){AE(y,q,p);
return q})},AE=function(y,q,Q){var p=y.N[Q];
p||(p=new Set,y.N[Q]=p);p.add(q)},ySc=function(y,q,Q){var p=sww(q);
Q=ovh(Q);if(!Q)return g.kC.resolve([]);Q=new Q(q);y=y.K.objectStore("EntityAssociationStore");q=[];Q=g.t(Q.W());for(var v=Q.next();!v.done;v=Q.next())q.push(g.z3(y,{parentEntityKey:p,childEntityKey:v.value}));return g.kC.all(q).then(function(d){return d.map(function(T){return T[1]})})},Xqq=function(y,q){return y.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(q))},GDX=function(y,q,Q){var p=sww(q);
return Xqq(y,p).then(function(){return ySc(y,q,Q)})},iyw=function(y,q,Q){if(Q.has(q))return g.kC.resolve(void 0);
Q.add(q);return qIu(y,q).then(function(p){return y.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(q)).then(function(){return p})}).then(function(p){var v=g.kC.resolve(void 0);
p=g.t(p);for(var d=p.next(),T={};!d.done;T={ya:void 0},d=p.next())T.ya=d.value,v=v.then(function(O){return function(){return iyw(y,O.ya,Q)}}(T));
return v}).then(function(){})},qIu=function(y,q){var Q=y.K.objectStore("EntityAssociationStore");
return Q.index("byParentEntityKey").getAll(IDBKeyRange.only(q)).then(function(p){var v=[];p=g.t(p);for(var d=p.next();!d.done;d=p.next())d=d.value,v.push(Q.index("byChildEntityKey").getAll(d.childEntityKey));return g.kC.all(v)}).then(function(p){var v=[];
p=g.t(p);for(var d=p.next();!d.done;d=p.next())d=d.value,d.length===1&&v.push(d[0].childEntityKey);return v})},GF=function(){},jTS=function(){this.K={};
this.K[0]=new GF;if(!g.kQ("aes_pes_encoder_killswitch")){var y=this.K;try{var q=g.Pn();var Q=UNc(q);var p=new UO(new g.Ko(Q),new g.xV(Q))}catch(v){throw y=v instanceof Error?new c7("KEY_CREATION_FAILED",{originalMessage:v.message}):new c7("KEY_CREATION_FAILED"),g.l$(y),y;}y[1]=p}},eQ_=function(y,q){q=q===void 0?0:q;
y=y.K[q];if(!y)throw q=new c7("INVALID_ENCODER_VERSION",{lZ:q}),g.l$(q),q;return y},P7=function(y,q){g.I.call(this);
this.token=y;this.K=q;this.observers=[];y=new g.CS.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Pn());y.onmessage=this.W.bind(this);this.channel=y},ii=function(y,q,Q){var p,v,d,T;
return g.M(function(O){if(O.K==1)return g.R(O,ljc(y.token),2);if(O.K!=3)return p=O.W,g.R(O,g.lv(p,["EntityStore","EntityAssociationStore"],q,function(w){v=new A9S(w,y.K);return Q(v)}),3);
d=O.W;v&&(T=v.N,Object.keys(T).length>0&&(y.channel.postMessage(T),QTc(y,T)));return O.return(d)})},XC=function(y,q,Q){return ii(y,{mode:"readwrite",
ij:!0},function(p){return eq(p,q,Q)})},pwn=function(y,q){return ii(y,{mode:"readwrite",
ij:!0},function(Q){return Pun(Q,q,"offlineOrchestrationActionWrapperEntity")})},v9q=function(y,q){return ii(y,{mode:"readwrite",
ij:!0},function(Q){return B7(Q,q)})},dvw=function(y){return ii(y,{mode:"readwrite",
ij:!0},function(q){return mNk(q,"videoPlaybackPositionEntity")})},mp=function(y,q,Q){return ii(y,{mode:"readonly",
ij:!0},function(p){return r8(p,q,Q)})},Ce=function(y,q,Q){return ii(y,{mode:"readonly",
ij:!0},function(p){return o7(p,q,Q)})},QTc=function(y,q){y=g.t(y.observers);
for(var Q=y.next();!Q.done;Q=y.next())Q=Q.value,Q(q)},TNn=function(){var y,q,Q;
return g.M(function(p){if(p.K==1)return g.EC(p,2),g.R(p,g.y1(),4);if(p.K!=2){y=p.W;if(!y||!g.iw()||typeof g.CS.BroadcastChannel==="undefined")return p.return();q=new jTS;return p.return(new P7(y,q))}Q=g.Rj(p);Q instanceof Error&&g.l$(Q);return p.return()})},y4=function(){VTn||(VTn=TNn());
return VTn},OGG=function(y){var q;
y=(q=y.options)==null?void 0:q.persistenceOption;return y==="ENTITY_PERSISTENCE_OPTION_PERSIST"||y==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},wwS=function(y){var q;
return g.M(function(Q){return Q.K==1?g.R(Q,y4(),2):(q=Q.W)?g.R(Q,ii(q,"readwrite",function(p){for(var v={},d=g.t(y),T=d.next(),O={};!T.done;O={LF:void 0,O0:void 0},T=d.next())O.LF=T.value,O.LF.entityKey&&OGG(O.LF)&&(O.O0=g.Tu(O.LF.payload),T=void 0,O.LF.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(T=function(w){return function(){return eq(p,w.LF.payload[w.O0],w.O0)}}(O)),O.LF.type==="ENTITY_MUTATION_TYPE_DELETE"&&(T=function(w){return function(){return B7(p,w.LF.entityKey)}}(O)),O.LF.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(T=function(w){return function(){return Cuu(p,w.LF.entityKey,w.LF.payload[w.O0],w.O0)}}(O)),T&&(v[O.LF.entityKey]=v[O.LF.entityKey]?v[O.LF.entityKey].then(T):T()));
return g.kC.all(Object.values(v))}),0):Q.return()})},JSk=function(y){var q;
return g.M(function(Q){if(Q.K==1){q=y.mutations;if(!q||q.length<=0)return Q.return();if(g.Mg){var p={type:"ENTITY_LOADED"};q!==void 0&&(p.payload=q);g.Mg.dispatch(p)}return g.R(Q,wwS(q),2)}q.length=0;g.tH(Q)})},FCw=function(y){return y!==void 0},YIC=function(y){var q=g.VQ();
q=Object.assign({},q);y=Object.assign({},y);for(var Q in q)y[Q]?(q[Q]!==4&&(q[Q]=y[Q]),delete y[Q]):q[Q]!==2&&(q[Q]=4);Object.assign(q,y);g.i69(q);JSON.stringify(q);return q},fMC=function(y){var q,Q;
return g.M(function(p){if(p.K==1)return g.R(p,g.y1(),2);if(p.K!=3)return(q=p.W)?g.R(p,g.Jk(q),3):p.return();Q=p.W;return p.return(g.lv(Q,["index","media","captions"],{mode:"readwrite",ij:!0},function(v){var d=IDBKeyRange.bound(y+"|",y+"~");v=[v.objectStore("index").delete(d),v.objectStore("media").delete(d),v.objectStore("captions").delete(d)];return g.kC.all(v).then(function(){})}))})},hLe=function(){var y,q;
return g.M(function(Q){if(Q.K==1)return g.R(Q,g.y1(),2);if(Q.K!=3){y=Q.W;if(!y)throw g.t_("rvdfd");return g.R(Q,g.Jk(y),3)}q=Q.W;return Q.return(g.lv(q,["index","media"],{mode:"readwrite",ij:!0},function(p){var v={};return g.nd(p.objectStore("index"),{},function(d){var T=d.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),O=g.kC.resolve(void 0);if(T){var w=T[1];T=T[2];v[w]=v[w]||{};var J;v[w][T]=g.qkg((J=d.getValue())==null?void 0:J.fmts)}else O=d.delete().then(function(){});
return g.kC.all([g.gU(d),O]).then(function(F){return g.t(F).next().value})}).then(function(){for(var d={},T=g.t(Object.keys(v)),O=T.next();!O.done;O=T.next()){O=O.value;
var w=v[O].v;d[O]=v[O].a&&w?1:2}var J=YIC(d);return g.Mxb(p.objectStore("media"),{},function(F){var Y=F.cursor.key.match(g.vTp);Y&&d[Y[1]]||p.objectStore("media").delete(F.cursor.key);return g.E09(F)}).then(function(){return J})})}))})},bGn=function(y,q){var Q,p;
return g.M(function(v){if(v.K==1)return g.R(v,g.y1(),2);if(v.K!=3){Q=v.W;if(!Q)throw g.t_("wct");return g.R(v,g.Jk(Q),3)}p=v.W;return g.R(v,g.lv(p,["captions"],{mode:"readwrite",ij:!0},function(d){var T=[];d=d.objectStore("captions");for(var O=0;O<q.length;O++){var w=g.z3(d,q[O],y+"|"+q[O].metadata.vss_id);T.push(w)}return g.kC.all(T)}),0)})},$vC=function(y){var q,Q,p;
return g.M(function(v){if(v.K==1)return q=IDBKeyRange.bound(y+"|",y+"~"),g.R(v,g.y1(),2);if(v.K!=3){Q=v.W;if(!Q)throw g.t_("gactfv");return g.R(v,g.Jk(Q),3)}p=v.W;return v.return(p.getAll("captions",q))})},KCC=function(y){return g.M(function(q){g.wx(y,0);
return q.return(fMC(y))})},xvm=function(y){return{context:g.QT(),
videoIds:y}},WCC=function(y){return{context:g.QT(),
playlistIds:y}},ZGe=function(y){return{context:g.QT(),
offlinePlaylistSyncChecks:y}},tTu=function(){this.K=new Map},kQu=function(){E9X||(E9X=new tTu);
return E9X},LCu=function(y,q){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:y},metadata:q,statusCode:void 0,csn:void 0,can:void 0}},aMm=function(y,q,Q){if(!Q){var p=p===void 0?!1:p;
Q=y.K.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Q||p)Q=g.ZX(16),y.K.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Q)}y={flowNonce:Q,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:q.eventType};q.metadata&&(y.flowMetadata=q.metadata);q.statusCode!==void 0&&(y.flowEventStatus=q.statusCode);q.csn&&(y.csn=q.csn);q.can&&(y.can=q.can);g.wU("flowEvent",y,void 0)},NNu=function(y){var q,Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM,DC,on,Oo,H,lo;
return g.M(function(Nw){if(Nw.K==1)return g.R(Nw,ii(y,{mode:"readonly",ij:!0},function(Qi){return o7(Qi,"playbackData").then(function(Sm){var E=Sm.map(function(gk){return gk.transfer}).filter(function(gk){return!!gk}),j3=Sm.map(function(gk){return gk.offlineVideoPolicy}).filter(function(gk){return!!gk}),HK=Sm.filter(function(gk){return!!gk.key}).map(function(gk){return g.po(g.QX(gk.key).entityId,"downloadStatusEntity")});
E=o7(Qi,"transfer",E);j3=o7(Qi,"offlineVideoPolicy",j3);HK=o7(Qi,"downloadStatusEntity",HK);var mn=E.then(function(gk){gk=gk.reduce(function(Gf,jm){(jm==null?0:jm.offlineVideoStreams)&&Gf.push.apply(Gf,g.hH(jm.offlineVideoStreams));return Gf},[]).filter(function(Gf){return!!Gf});
return o7(Qi,"offlineVideoStreams",gk)});
return g.kC.all([E,j3,mn,HK]).then(function(gk){var Gf=g.t(gk);gk=Gf.next().value;var jm=Gf.next().value;var vQ=Gf.next().value;Gf=Gf.next().value;return[Sm,gk,jm,vQ,Gf]})})}),2);
if(Nw.K!=3)return q=Nw.W,g.R(Nw,ii(y,{mode:"readonly",ij:!0},function(Qi){return o7(Qi,"mainDownloadsListEntity").then(function(Sm){var E,j3;return(j3=(E=Sm[0])==null?void 0:E.downloads)!=null?j3:[]})}),3);
Q=Nw.W;p=g.t(q);v=p.next().value;d=p.next().value;T=p.next().value;O=p.next().value;w=p.next().value;J=v;F=d;Y=T;f=O;h=w;b={};Z={};k={};S={};N={};l=[];u=g.t(F);for(c=u.next();!c.done;c=u.next())(X=c.value)&&(b[X.key]=X);A=g.t(Y);for(Tf=A.next();!Tf.done;Tf=A.next())(OC=Tf.value)&&(Z[OC.key]=OC);pS=g.t(h);for(YD=pS.next();!YD.done;YD=pS.next())(q9=YD.value)&&(k[q9.key]=q9);aj=g.t(f);for(Pp=aj.next();!Pp.done;Pp=aj.next())(Fc=Pp.value)&&(S[Fc.key]=Fc);Jm=g.t(Q);for(gg=Jm.next();!gg.done;gg=Jm.next())M9=
gg.value,pM=void 0,N[(pM=M9.videoItem)!=null?pM:""]=!0,M9.videoItem&&(on=DC=void 0,Oo=(on=(DC=g.QX(M9.videoItem))==null?void 0:DC.entityId)!=null?on:"",l.push({externalVideoId:Oo}));H=J.filter(function(Qi){if(!Qi||!Qi.key||!Qi.offlineVideoPolicy)return!1;Qi=g.QX(Qi.key).entityId;Qi=g.po(Qi,"downloadStatusEntity");var Sm;return!(Qi&&((Sm=k[Qi])==null?void 0:Sm.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
lo=H.map(function(Qi){var Sm=b[Qi.transfer],E=[];if(Sm==null?0:Sm.offlineVideoStreams)for(var j3=g.t(Sm.offlineVideoStreams),HK=j3.next();!HK.done;HK=j3.next())(HK=S[HK.value])&&E.push(HK);j3=Z[Qi.offlineVideoPolicy];HK=N;var mn=Qi==null?void 0:Qi.playerResponseTimestamp,gk=g.QX(j3.key).entityId;Qi=g.po(gk,"mainVideoEntity");if(j3.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Gf="OFFLINE_VIDEO_STATE_DISABLED";j3.expirationTimestamp&&Number(j3.expirationTimestamp)<Date.now()/1E3&&(Gf="OFFLINE_VIDEO_STATE_EXPIRED")}else if(j3.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Gf="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Sm==null?void 0:Sm.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Gf="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Gf="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Gf="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Gf="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Gf="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Gf="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Gf="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Gf==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Sm==null?void 0:Sm.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Gf="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Gf="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Gf=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}gk={id:gk,videoState:Gf};if(Sm==null?0:Sm.cotn)gk.cotn=Sm.cotn;if(Sm==null?0:Sm.maximumDownloadQuality)gk.selectedVideoQuality=Sm==null?void 0:Sm.maximumDownloadQuality;if(Sm==null?0:Sm.lastProgressTimeMs)gk.lastProgressTimeMs=Sm.lastProgressTimeMs;mn&&(gk.playerResponseSavedTimeMs=String(Number(mn)*1E3));Sm=String;mn=0;E=g.t(E);for(Gf=E.next();!Gf.done;Gf=E.next())if(Gf=Gf.value,Gf.streamsProgress){Gf=g.t(Gf.streamsProgress);for(var jm=Gf.next();!jm.done;jm=Gf.next()){var vQ=
void 0;mn+=Number((vQ=jm.value.numBytesDownloaded)!=null?vQ:0)}}gk.downloadedBytes=Sm(mn);gk.selectedOfflineMode=HK[Qi]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";j3.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(gk.offlinePlaybackDisabledReason=j3.offlinePlaybackDisabledReason);return gk});
return Nw.return({offlineVideos:lo,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:l}}})})},SIe=function(){this.locks=navigator.locks},HGh=function(){try{var y=g.qw("ytglobal.locks_");
if(y)return y;var q;if(q=navigator){var Q=navigator;q="locks"in Q&&!!Q.locks}if(q)return g.CS.localStorage&&g.CS.localStorage.getItem("noop"),y=new SIe,g.y_("ytglobal.locks_",y),y}catch(p){}},qh=function(){},RLh=function(){},sTX=function(y){if(y.includes(":"))throw Error("Invalid user cache name: "+y);
return y+":"+g.Pn("CacheStorage get")},MTG=function(){return g.M(function(y){if(jN!==void 0)return y.return(jN);
jN=new Promise(function(q){var Q;return g.M(function(p){switch(p.K){case 1:return g.EC(p,2),g.R(p,Q4.open("test-only"),4);case 4:return g.R(p,Q4.delete("test-only"),5);case 5:g.Hp(p,3);break;case 2:if(Q=g.Rj(p),Q instanceof Error&&Q.name==="SecurityError")return q(!1),p.return();case 3:q("caches"in window),g.tH(p)}})});
return y.return(jN)})},zLe=function(){return g.M(function(y){if(y.K==1)return g.R(y,MTG(),2);
if(!y.W)return y.return(void 0);lMm||(lMm=new RLh);return y.return(lMm)})},pT=function(y,q,Q){g.zI(new g.GH("Woffle: "+y,Q?{cotn:Q}:""));
q instanceof Error&&g.zI(q)},Dvm=function(y){var q;
return g.M(function(Q){if(Q.K==1)return g.R(Q,NNu(y),2);q=Q.W;g.wU("offlineStateSnapshot",q);g.tH(Q)})},vR=function(y){g.I.call(this);
var q=this;this.api=y;this.je={f5B:function(){return q.K},
s0p:function(){return q.W}};
typeof g.CS.BroadcastChannel!=="undefined"&&(this.K=new g.CS.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Pn()),this.K.onmessage=this.N.bind(this),this.W=new g.CS.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Pn()),this.W.onmessage=this.Y.bind(this))},dE=function(y,q){y.api.AK("onOfflineOperationFailure",q);
var Q;(Q=y.K)==null||Q.postMessage(q)},uoe=function(y,q,Q){var p=this;
this.C=y;this.j=q;this.visibility=Q;this.J=this.X=this.G=this.N=this.K=!1;this.Y=new g.y0(function(){p.Qz()});
this.je={J_:function(){return p.W},
Qz:function(){p.Qz()},
GHK:function(){return p.Y}};
this.visibility.subscribe("visibilitystatechange",function(){p.ol()})},IMq=function(y){if(!y.N&&!y.K){var q=HGh();
if(q){y.N=!0;var Q=g.Pn("OfflineLockManager");q.request("woffle_orchestration_leader:"+Q,{},function(){var p,v;return g.M(function(d){switch(d.K){case 1:return g.EC(d,2),y.W=new g.$9,y.K=!0,y.N=!1,g.R(d,y.C(),4);case 4:return g.R(d,y.W.promise,5);case 5:g.Hp(d,0);break;case 2:p=g.Rj(d),y.Qz(),p instanceof Error&&(v=p,v.args=[{name:"WoLockManagerError",A2:p.name}],g.l$(v)),g.tH(d)}})})}}},n9u=function(y){y.K&&(y.J=!0,TC(y))},g9m=function(y,q){y.K&&(y.G=q,TC(y))},cSq=function(y,q){y.K&&(y.X=q,TC(y))},
TC=function(y){y.X&&y.G&&y.J&&y.visibility.isBackground()?g.qM(y.Y,6E4):y.Y.stop()},V4=function(y){var q;
y.offlineDeleteReason=(q=y.offlineDeleteReason)!=null?q:"OFFLINE_DELETE_REASON_UNKNOWN";var Q;y.offlineModeType=(Q=y.offlineModeType)!=null?Q:"OFFLINE_NOW";g.wU("offlineDeleteEvent",y)},OF=function(y,q){var Q=q.videoId;
var p=q.Hx;q=q.offlineModeType;y.encryptedVideoId=Q;y.cotn=p==null?void 0:p.cotn;y.offlineabilityFormatType=p==null?void 0:p.maximumDownloadQuality;var v;y.isRefresh=(v=p==null?void 0:p.isRefresh)!=null?v:!1;var d;y.softErrorCount=(d=p==null?void 0:p.transferRetryCount)!=null?d:0;y.offlineModeType=q!=null?q:"OFFLINE_NOW";(y.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&y.statusType==="UNKNOWN_STATUS_TYPE"||!y.transferStatusType&&!y.statusType)&&g.zI(Error("Woffle unknown transfer status"));
g.wU("offlineTransferStatusChanged",y)},Uvq=function(y){OF({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},y)},rSc=function(y,q,Q,p){p={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!p};q&&Q&&(q=Math.floor(q/1024).toFixed(),Q=Math.floor(Q/1024).toFixed(),p.alreadyDownloadedKbytes=q,p.totalFetchedKbytes=q,p.totalContentKbytes=Q);OF(p,y)},o9_=function(y){OF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},y)},ASG=function(y){OF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},y)},eLc=function(y){switch(y){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
wE=function(y){var q,Q,p;
return((p=(q=y.actionMetadata)==null?void 0:(Q=q.retryScheduleIntervalsInSeconds)==null?void 0:Q.length)!=null?p:0)>0},Ju=function(y){return y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!y.entityKey},FS=function(y){return y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!y.entityKey},YL=function(y){return y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!y.entityKey},BNX=function(y){return y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!y.entityKey},
fT=function(y,q,Q,p,v){v=v===void 0?!1:v;
var d,T,O,w,J,F;return g.M(function(Y){if(Y.K==1)return d=g.po(y,q),T=g.po(y,"downloadStatusEntity"),g.R(Y,ii(Q,{mode:"readonly",ij:!0},function(f){return g.kC.all([r8(f,d,q),r8(f,T,"downloadStatusEntity")])}),2);
O=Y.W;w=O.length?O[0]:void 0;if(!w)return Y.ej(0);J=GQX;if(F=O.length>1?O[1]:void 0){if(F.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!v)return Y.return();F.downloadState=p}else F={key:T,downloadState:p};g.gy(w,J,F);return g.R(Y,ii(Q,{mode:"readwrite",ij:!0},function(f){return g.kC.all([eq(f,w,q),eq(f,F,"downloadStatusEntity")])}),0)})},hu=function(y,q){return y.actionType===q.actionType&&y.entityKey===q.entityKey},bY=function(y,q){if(y&&y.transferState!=="TRANSFER_STATE_COMPLETE"&&y.transferState!==
"TRANSFER_STATE_FAILED"){var Q=g.QX(y.key).entityId;
OF({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Q,Hx:y,offlineModeType:q})}},$L=function(y){if(!y||!y.thumbnails)return[];
var q=[];y=g.t(y.thumbnails);for(var Q=y.next();!Q.done;Q=y.next())Q=Q.value,Q.url&&q.push(Q.url);return q},PWC=function(y,q,Q){Q=Q===void 0?[]:Q;
var p,v,d,T,O,w,J,F,Y,f,h,b,Z;return g.M(function(k){if(k.K==1)return Q.length?g.R(k,Ce(y,q),2):k.return([]);p=k.W;v=new Set;d=g.t(p);for(T=d.next();!T.done;T=d.next())if(O=T.value,w=O.id||O.key)J=g.QX(w).entityId,v.add(J);F=[];Y=g.t(Q);for(f=Y.next();!f.done;f=Y.next())h=f.value,b=h.offlineVideoData,Z=void 0,((Z=b)==null?0:Z.videoId)&&!v.has(b.videoId)&&F.push(h);return k.return(F)})},iG_=function(y,q,Q){return new g.EB(y,{cotn:q,
raw_player_response:Q,download_media:!0,start:Infinity,disable_watch_next:!0})},Xwm=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},KT=function(y,q,Q,p,v,d,T,O,w,J,F){this.entityType=y;
this.actionId=q;this.action=Q;this.parentActionId=p;this.rootActionId=v===void 0?q:v;this.childActionIds=d;this.prereqActionId=T;this.postreqActionIds=O;this.hasChildActionFailed=J;this.retryScheduleIndex=0;this.K=F||Date.now();this.retryScheduleIndex=w||0},xL=function(y){if(!y.key)throw Error("Entity key is required.");
if(!y.actionProto)throw Error("OfflineOrchestrationAction is required.");var q=g.QX(y.key),Q=g.QX(y.actionProto.entityKey);return new KT(Q.entityType,q.entityId,y.actionProto,y.parentActionId,y.rootActionId,y.childActionIds,y.prereqActionId,y.postreqActionIds,y.retryScheduleIndex,y.hasChildActionFailed,Number(y.enqueueTimeSec)*1E3)},WR=function(y){return{key:g.po(y.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:y.action,parentActionId:y.parentActionId,rootActionId:y.rootActionId,childActionIds:y.childActionIds,prereqActionId:y.prereqActionId,postreqActionIds:y.postreqActionIds,retryScheduleIndex:y.retryScheduleIndex,hasChildActionFailed:y.hasChildActionFailed,enqueueTimeSec:(y.K/1E3).toFixed()}},mv_=function(){var y;
return g.M(function(q){return q.K==1?g.R(q,zLe(),2):(y=q.W)?q.return(y.delete("yt-player-local-img")):q.return(!0)})},ZS=function(y){var q,Q;
return g.M(function(p){if(p.K==1)return g.R(p,zLe(),2);if(p.K!=3){q=p.W;if(!q)throw Error("Cache API not supported");return y.length?g.R(p,q.open("yt-player-local-img"),3):p.return()}Q=p.W;return g.R(p,Promise.all(y.map(function(v){return Q.delete(v)})),0)})},tu=function(y){var q,Q;
return g.M(function(p){if(p.K==1)return g.R(p,zLe(),2);if(p.K!=3){q=p.W;if(!q)throw Error("Cache API not supported");return y.length?g.R(p,q.open("yt-player-local-img"),3):p.return()}Q=p.W;return g.R(p,Q.addAll(y),0)})},EF=function(y,q,Q,p,v){var d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM;
return g.M(function(DC){switch(DC.K){case 1:return d=g.po(y,"mainVideoEntity"),T=g.po(y,"ytMainChannelEntity"),O=g.po(y,"transfer"),w=g.po(y,"videoDownloadContextEntity"),g.R(DC,ii(q,{mode:"readonly",ij:!0},function(on){return g.kC.all([r8(on,d,"mainVideoEntity"),r8(on,T,"ytMainChannelEntity"),r8(on,O,"transfer"),r8(on,w,"videoDownloadContextEntity"),o7(on,"ytMainChannelEntity"),o7(on,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:J=DC.W;F=g.t(J);Y=F.next().value;f=F.next().value;h=F.next().value;b=F.next().value;Z=F.next().value;k=F.next().value;S=Y;N=f;l=h;u=b;c=Z;X=k;if(!S&&!N){DC.ej(3);break}A=S?$L(S.thumbnail):[];if(!N){Tf=[];DC.ej(4);break}return g.R(DC,CWm(N,c),5);case 5:Tf=DC.W;case 4:return OC=Tf,g.R(DC,ZS(A.concat(OC)),3);case 3:pS=[];YD=g.po(y,"downloadStatusEntity");q9=g.t(X);for(aj=q9.next();!aj.done;aj=q9.next())Pp=aj.value,Fc=g.QX(Pp.key).entityId,Jm=xL(Pp),gg=g.QX(Jm.action.entityKey).entityId,Fc!==y&&
gg!==y||hu(Q,Pp.actionProto)||pS.push(Pp.key);return g.R(DC,ii(q,{mode:"readwrite",ij:!0},function(on){var Oo=pS.map(function(H){return B7(on,H)});
Oo.push(B7(on,d,{PD:!0}));Oo.push(B7(on,YD,{PD:!0}));return g.kC.all(Oo)}),7);
case 7:pM=(M9=u)==null?void 0:M9.offlineModeType,v&&(V4(v),v.offlineModeType&&(pM=v.offlineModeType)),bY(l,pM),dE(p,{entityKey:d,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.tH(DC)}})},jpm=function(y,q,Q,p){var v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM,DC,on,Oo,H,lo,Nw,Qi,Sm,E,j3,HK,mn,gk,Gf,jm,vQ,An,L;
return g.M(function(W){switch(W.K){case 1:return v=g.po(y,"mainPlaylistEntity"),d=g.po(y,"ytMainChannelEntity"),g.R(W,ii(q,{mode:"readonly",ij:!0},function(a){return g.kC.all([r8(a,v,"mainPlaylistEntity"),r8(a,d,"ytMainChannelEntity"),o7(a,"mainPlaylistEntity"),o7(a,"mainDownloadsListEntity"),o7(a,"ytMainChannelEntity"),o7(a,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=W.W;O=g.t(T);w=O.next().value;J=O.next().value;F=O.next().value;Y=O.next().value;f=O.next().value;h=O.next().value;b=w;Z=J;k=F;S=Y;N=f;l=h;if(!b&&!Z){W.ej(3);break}u=b?yAC(b):[];if(!Z){c=[];W.ej(4);break}return g.R(W,CWm(Z,N),5);case 5:c=W.W;case 4:return X=c,g.R(W,ZS(u.concat(X)),3);case 3:A=[];Tf=new Map;if(!b){W.ej(7);break}return g.R(W,qam(b,k,S),8);case 8:A=W.W;OC=g.t(A);for(pS=OC.next();!pS.done;pS=OC.next())YD=pS.value,Tf.set(YD,{videoId:YD,playlistId:y,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.R(W,ii(q,{mode:"readonly",ij:!0},function(a){return g.kC.all([o7(a,"transfer"),o7(a,"videoDownloadContextEntity")])}),9);
case 9:q9=W.W;aj=g.t(q9);Pp=aj.next().value;Fc=aj.next().value;Jm=Pp;gg=Fc;M9=g.t(Jm);for(pM=M9.next();!pM.done;pM=M9.next())DC=pM.value,on=g.QX(DC.key).entityId,(Oo=Tf.get(on))&&DC&&(Oo.cotn=DC.cotn);H=g.t(gg);for(lo=H.next();!lo.done;lo=H.next())Nw=lo.value,Qi=g.QX(Nw.key).entityId,(Sm=Tf.get(Qi))&&Nw&&(Sm.offlineModeType=Nw.offlineModeType);case 7:E=[];j3=g.t(l);for(HK=j3.next();!HK.done;HK=j3.next())mn=HK.value,gk=g.QX(mn.key).entityId,Gf=xL(mn),gk!==y&&Gf.rootActionId!==y||hu(Q,mn.actionProto)||
E.push(mn.key);jm=g.po(y,"mainPlaylistEntity");return g.R(W,ii(q,{mode:"readwrite",ij:!0},function(a){var z=E.map(function(B){return B7(a,B)});
z.push(B7(a,jm,{PD:!0}));return g.kC.all(z)}),10);
case 10:if(!b){W.ej(0);break}A.reverse();if(!A){W.ej(0);break}vQ=g.t(A);An=vQ.next();case 13:if(An.done){W.ej(0);break}L=An.value;return g.R(W,EF(L,q,Q,p,Tf.get(L)),14);case 14:An=vQ.next(),W.ej(13)}})},pHk=function(y,q,Q,p){var v,d,T,O,w,J,F,Y,f;
return g.M(function(h){if(h.K==1)return v=g.po("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),d=new Map,g.R(h,ii(y,{mode:"readwrite",ij:!0},function(b){var Z=o7(b,"transfer"),k=o7(b,"offlineOrchestrationActionWrapperEntity"),S=o7(b,"videoDownloadContextEntity"),N=r8(b,v,"mainDownloadsListEntity");return g.kC.all([Z,k,S,N]).then(function(l){l=g.t(l);var u=l.next().value;var c=l.next().value;var X=l.next().value;var A=l.next().value;l=Qpm.map(function(OC){return mNk(b,OC)});
c=g.t(c);for(var Tf=c.next();!Tf.done;Tf=c.next())Tf=Tf.value,hu(q,Tf.actionProto)||l.push(B7(b,Tf.key,{PD:!0}));A&&(A.downloads=[],l.push(eq(b,A,"mainDownloadsListEntity")));if(X)for(X=g.t(X),A=X.next();!A.done;A=X.next())A=A.value,c=g.QX(A.key).entityId,c=g.po(c,"transfer"),d.set(c,A.offlineModeType);return g.kC.all(l).then(function(){return u})})}),2);
T=h.W;O=g.t(T);for(w=O.next();!w.done;w=O.next())J=w.value,bY(J,d.get(J.key)),F=g.QX(J.key).entityId,Y={videoId:F,offlineDeleteReason:p,cotn:J.cotn,offlineModeType:d.get(J.key)},V4(Y),f=g.po(F,"mainVideoEntity"),dE(Q,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.R(h,mv_(),0)})},yAC=function(y,q){var Q=[];
if(y.thumbnailStyleData){y=g.t(y.thumbnailStyleData);for(var p=y.next();!p.done;p=y.next()){var v=void 0,d=void 0,T=void 0;Q=Q.concat($L((v=p.value)==null?void 0:(d=v.value)==null?void 0:(T=d.collageThumbnail)==null?void 0:T.coverThumbnail))}}q=$L(q);return Q.concat(q)},qam=function(y,q,Q){var p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC;
return g.M(function(pS){p=[];v=new Set;if(Q.length)for(d=g.t(Q),T=d.next();!T.done;T=d.next())if(O=T.value,w=void 0,(w=O.downloads)==null?0:w.length)for(J=g.t(O.downloads),F=J.next();!F.done;F=J.next())Y=F.value,Y.videoItem&&(f=g.QX(Y.videoItem).entityId,v.add(f));if(y.videos){h=g.t(y.videos);for(b=h.next();!b.done;b=h.next())Z=b.value,k=JSON.parse(g.QX(Z).entityId),k.videoId&&!v.has(k.videoId)&&p.push(k.videoId);S=g.t(q);for(N=S.next();!N.done;N=S.next())if(l=N.value,l.key!==y.key&&(u=l.videos))for(c=
g.t(u),X=c.next();!X.done;X=c.next())A=X.value,Tf=JSON.parse(g.QX(A).entityId),Tf.videoId&&(OC=p.indexOf(Tf.videoId),OC!==-1&&p.splice(OC,1))}return pS.return(p)})},CWm=function(y,q){var Q,p,v,d,T,O,w,J;
return g.M(function(F){Q=$L(y.avatar);p=g.t(q);for(v=p.next();!v.done;v=p.next())if(d=v.value,d.id!==y.id)for(T=g.t($L(d.avatar)),O=T.next();!O.done;O=T.next())w=O.value,J=Q.indexOf(w),J!==-1&&Q.splice(J,1);return F.return(Q)})},v0C=function(y){var q;
return g.M(function(Q){q=g.U(y.frameworkUpdates,kL);return y.frameworkUpdates&&q?g.R(Q,JSk(q),0):Q.return()})},TPm=function(y){var q;
if((q=y.onResponseReceivedActions)!=null&&q.length){var Q;y=(Q=g.U(g.U(y.onResponseReceivedActions[0],dnS),g.V_q))==null?void 0:Q.actions;if(y!=null&&y.length)return y}},VxX=function(y){var q,Q,p;
return g.M(function(v){if(v.K==1)return y?g.R(v,mp(y,g.uT,"mainDownloadsListEntity"),2):v.return([]);q=v.W;return((Q=q)==null?0:(p=Q.downloads)==null?0:p.length)?v.return(q.downloads.map(function(d){var T;return(T=d.videoItem)!=null?T:""})):v.return([])})},wHn=function(y,q){var Q;
return g.M(function(p){return p.K==1?g.R(p,OXq(y,q),2):(Q=p.W)?g.R(p,ii(y,{mode:"readwrite",ij:!0},function(v){var d=[eq(v,Q.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Q.mainDownloadsListEntity&&d.push(eq(v,Q.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.kC.all(d)}),0):p.ej(0)})},OXq=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l;
return g.M(function(u){if(u.K==1)return Q=g.po("main_downloads_library_id","mainDownloadsLibraryEntity"),p=g.po("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.R(u,ii(y,{mode:"readonly",ij:!0},function(c){return g.kC.all([r8(c,Q,"mainDownloadsLibraryEntity"),r8(c,p,"mainDownloadsListEntity")])}),2);
v=u.W;d=g.t(v);T=d.next().value;O=d.next().value;w=T;J=O;w||(w={id:Q});F=g.t(q);for(Y=F.next();!Y.done;Y=F.next())if(f=Y.value,f===g.uT){if(w.smartDownloadsList)return u.return();w.smartDownloadsList=f}else if(h=g.QX(f).entityType,b={},h==="mainPlaylistEntity"?b.playlistItem=f:h==="mainVideoEntity"&&(b.videoItem=f),!g.hn(b)){Z=void 0;if((Z=J)==null?0:Z.downloads){k=!1;S=g.t(J.downloads);for(N=S.next();!N.done;N=S.next())if(l=N.value,l.playlistItem===f||l.videoItem===f){k=!0;break}k||J.downloads.push(b)}else J=
{id:p,downloads:[b]};w.downloadsList=p}return u.return({mainDownloadsLibraryEntity:w,mainDownloadsListEntity:J})})},JAu=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k;
return g.M(function(S){if(S.K==1)return Q=g.po("main_downloads_library_id","mainDownloadsLibraryEntity"),p=g.po("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.R(S,ii(y,{mode:"readonly",ij:!0},function(N){return g.kC.all([r8(N,Q,"mainDownloadsLibraryEntity"),r8(N,p,"mainDownloadsListEntity"),r8(N,g.uT,"mainDownloadsListEntity")])}),2);
v=S.W;d=g.t(v);T=d.next().value;O=d.next().value;w=d.next().value;J=T;F=O;Y=w;if(!J)return S.ej(0);if(q===g.uT&&((f=Y)==null?0:f.downloads))Y.downloads=[];else if((h=F)==null?0:h.downloads)for(b=g.QX(q).entityType,Z=0;Z<F.downloads.length;Z++)if(k=F.downloads[Z],b==="mainVideoEntity"&&k.videoItem===q){F.downloads.splice(Z,1);break}else if(b==="mainPlaylistEntity"&&k.playlistItem===q){F.downloads.splice(Z,1);break}return g.R(S,ii(y,{mode:"readwrite",ij:!0},function(N){var l=[eq(N,J,"mainDownloadsLibraryEntity")];
F&&l.push(eq(N,F,"mainDownloadsListEntity"));Y&&l.push(eq(N,Y,"mainDownloadsListEntity"));return g.kC.all(l)}),0)})},LT=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f;
return g.M(function(h){if(h.K==1)return Q=g.po(q,"transfer"),p=g.po(q,"videoDownloadContextEntity"),g.R(h,ii(y,{mode:"readonly",ij:!0},function(b){return g.kC.all([r8(b,Q,"transfer"),r8(b,p,"videoDownloadContextEntity")])}),2);
v=h.W;d=g.t(v);T=d.next().value;O=d.next().value;w=T;J=O;f={videoId:q,cotn:(F=w)==null?void 0:F.cotn,offlineModeType:(Y=J)==null?void 0:Y.offlineModeType};return h.return(f)})},av=function(y,q,Q,p,v){var d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf;
return g.M(function(OC){switch(OC.K){case 1:return d=g.po(y,"musicTrack"),T=g.po(y,"transfer"),g.R(OC,ii(q,{mode:"readonly",ij:!0},function(pS){return g.kC.all([r8(pS,d,"musicTrack"),r8(pS,T,"transfer"),o7(pS,"musicTrack"),o7(pS,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=OC.W;w=g.t(O);J=w.next().value;F=w.next().value;Y=w.next().value;f=w.next().value;h=J;b=F;Z=Y;k=f;if(!h){OC.ej(3);break}return g.R(OC,Fu_(h,Z),4);case 4:return S=OC.W,g.R(OC,ZS(S),3);case 3:N=[];l=g.t(k);for(u=l.next();!u.done;u=l.next())c=u.value,X=g.QX(c.key).entityId,A=xL(c),Tf=g.QX(A.action.entityKey).entityId,X!==y&&Tf!==y||hu(Q,c.actionProto)||N.push(c.key);return g.R(OC,ii(q,{mode:"readwrite",ij:!0},function(pS){var YD=N.map(function(q9){return B7(pS,q9)});
YD.push(B7(pS,d,{PD:!0}));return g.kC.all(YD)}),6);
case 6:bY(b),v&&V4(v),dE(p,{entityKey:d,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.tH(OC)}})},Nh=function(y,q,Q,p,v){var d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM,DC,on,Oo,H,lo;
return g.M(function(Nw){switch(Nw.K){case 1:return d=g.po(y,q),T=g.po("music_downloads_library_id","musicDownloadsLibraryEntity"),g.R(Nw,ii(Q,{mode:"readonly",ij:!0},function(Qi){return g.kC.all([r8(Qi,d,q),r8(Qi,T,"musicDownloadsLibraryEntity"),o7(Qi,q),o7(Qi,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:O=Nw.W;w=g.t(O);J=w.next().value;F=w.next().value;Y=w.next().value;f=w.next().value;h=J;b=F;Z=Y;k=f;if(!h){Nw.ej(3);break}return g.R(Nw,Fu_(h,Z),4);case 4:return S=Nw.W,g.R(Nw,ZS(S),3);case 3:N=[];l=new Map;if(!h){Nw.ej(6);break}return g.R(Nw,Yam(h,Z,b),7);case 7:N=Nw.W;u=g.t(N);for(c=u.next();!c.done;c=u.next())X=c.value,A=g.QX(X).entityId,l.set(A,{videoId:A,playlistId:y,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.R(Nw,Ce(Q,"transfer"),8);case 8:for(Tf=Nw.W,OC=
g.t(Tf),pS=OC.next();!pS.done;pS=OC.next())YD=pS.value,q9=g.QX(YD.key).entityId,(aj=l.get(q9))&&YD&&(aj.cotn=YD.cotn);case 6:Pp=[];Fc=g.t(k);for(Jm=Fc.next();!Jm.done;Jm=Fc.next())gg=Jm.value,M9=g.QX(gg.key).entityId,pM=xL(gg),M9!==y&&pM.rootActionId!==y||hu(p,gg.actionProto)||Pp.push(gg.key);DC=g.po(y,q);return g.R(Nw,ii(Q,{mode:"readwrite",ij:!0},function(Qi){var Sm=Pp.map(function(E){return B7(Qi,E)});
Sm.push(B7(Qi,DC,{PD:!0}));return g.kC.all(Sm)}),9);
case 9:if(!h){Nw.ej(0);break}N.reverse();if(!N.length){Nw.ej(0);break}on=g.t(N);Oo=on.next();case 12:if(Oo.done){Nw.ej(0);break}H=Oo.value;lo=g.QX(H).entityId;if(!lo){Nw.ej(13);break}return g.R(Nw,av(lo,Q,p,v,l.get(lo)),13);case 13:Oo=on.next(),Nw.ej(12)}})},SN=function(y,q,Q){var p,v,d,T,O,w,J;
return g.M(function(F){if(F.K==1)return g.R(F,ii(y,{mode:"readwrite",ij:!0},function(Y){var f=o7(Y,"transfer"),h=o7(Y,"offlineOrchestrationActionWrapperEntity");return g.kC.all([f,h]).then(function(b){b=g.t(b);var Z=b.next().value;var k=b.next().value;b=feX.map(function(u){return mNk(Y,u)});
k=g.t(k);for(var S=k.next();!S.done;S=k.next()){S=S.value;var N=g.QX(S.actionProto.entityKey).entityType==="musicTrack",l=S.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";hu(q,S.actionProto)||N&&(!N||l)||b.push(B7(Y,S.key,{PD:!0}))}return g.kC.all(b).then(function(){return Z})})}),2);
p=F.W;v=g.t(p);for(d=v.next();!d.done;d=v.next())T=d.value,bY(T),O=g.QX(T.key).entityId,w={videoId:O,offlineDeleteReason:void 0,cotn:T.cotn},V4(w),J=g.po(O,"musicTrack"),dE(Q,{entityKey:J,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.R(F,mv_(),0)})},hen=function(y){for(var q,Q=g.t(y.additionalMetadatas),p=Q.next();!p.done;p=Q.next())p=p.value,p.offlineMusicVideoData&&(q=p.offlineMusicVideoData);
var v,d,T,O,w;return{id:g.po(y.videoId,"musicTrack"),videoId:y.videoId,title:y.title,thumbnailDetails:y.thumbnail,lengthMs:String(Number(y.lengthSeconds)*1E3),albumTitle:(v=q)==null?void 0:v.releaseTitle,musicVideoType:(d=q)==null?void 0:d.musicVideoType,contentRating:{explicitType:(T=q)==null?void 0:T.explicitType},artistNames:((O=q)==null?void 0:O.byline)||((w=q)==null?void 0:w.channelName),downloadMetadata:g.po(y.videoId,"musicTrackDownloadMetadataEntity")}},Yam=function(y,q,Q){var p,v,d,T,O,w,
J,F,Y,f,h,b,Z,k,S,N,l,u;
return g.M(function(c){p=[];v=new Set;if((d=Q)==null?0:(T=d.downloadedTracks)==null?0:T.length)for(O=g.t(Q.downloadedTracks),w=O.next();!w.done;w=O.next())J=w.value,v.add(J);if(y.tracks){F=g.t(y.tracks);for(Y=F.next();!Y.done;Y=F.next())f=Y.value,v.has(f)||p.push(f);h=g.t(q);for(b=h.next();!b.done;b=h.next())if(Z=b.value,Z.id!==y.id&&(k=Z.tracks))for(S=g.t(k),N=S.next();!N.done;N=S.next())l=N.value,u=p.indexOf(l),u!==-1&&p.splice(u,1)}return c.return(p)})},Fu_=function(y,q){var Q,p,v,d,T,O,w,J;
return g.M(function(F){Q=$L(y.thumbnailDetails);p=g.t(q);for(v=p.next();!v.done;v=p.next())if(d=v.value,d.id!==y.id)for(T=g.t($L(d.thumbnailDetails)),O=T.next();!O.done;O=T.next())w=O.value,J=Q.indexOf(w),J!==-1&&Q.splice(J,1);return F.return(Q)})},bXh=function(y,q){var Q,p,v,d,T,O,w,J,F;
return g.M(function(Y){if(Y.K==1)return Q=g.po("music_downloads_library_id","musicDownloadsLibraryEntity"),g.R(Y,mp(y,Q,"musicDownloadsLibraryEntity"),2);(p=Y.W)||(p={id:Q});v=g.QX(q).entityType;v==="musicTrack"?(d=p.downloadedTracks)!=null&&d.includes(q)||(p.downloadedTracks=((T=p.downloadedTracks)!=null?T:[]).concat(q)):v==="musicPlaylist"?(O=p.downloadedPlaylists)!=null&&O.includes(q)||(p.downloadedPlaylists=((w=p.downloadedPlaylists)!=null?w:[]).concat(q)):v!=="musicAlbumRelease"||(J=p.downloadedAlbumReleases)!=
null&&J.includes(q)||(p.downloadedAlbumReleases=((F=p.downloadedAlbumReleases)!=null?F:[]).concat(q));return g.R(Y,XC(y,p,"musicDownloadsLibraryEntity"),0)})},$nX=function(y,q){var Q,p,v,d,T,O,w;
return g.M(function(J){if(J.K==1)return Q=g.po("music_downloads_library_id","musicDownloadsLibraryEntity"),g.R(J,mp(y,Q,"musicDownloadsLibraryEntity"),2);p=J.W;if(!p)return J.ej(0);v=g.QX(q).entityType;v==="musicTrack"?d=p.downloadedTracks:v==="musicPlaylist"&&(d=p.downloadedPlaylists);if((T=d)==null?0:T.length)for(O=0;O<d.length;O++)if(w=d[O],w===q){d.splice(O,1);break}return g.R(J,XC(y,p,"musicDownloadsLibraryEntity"),0)})},Ku_=function(y){var q=y.videos;
y=[];var Q=[];if(q){q=g.t(q);for(var p=q.next();!p.done;p=q.next()){var v=p.value.offlineVideoData.videoId;p=g.po(v,"musicTrack");v=g.po(v,"musicTrackDownloadMetadataEntity");y.push(p);Q.push(v)}}return{eq:y,Sq:Q}},HR=function(y,q,Q){q={track:hen(q)};
Q&&(q.playlistId=Q);if(y=g.U(y.actionMetadata,xn_))q.maximumDownloadQuality=y.maximumDownloadQuality;return{musicTrackEntityActionMetadata:q}},ZXc=function(y){var q,Q,p,v,d,T,O,w;
return g.M(function(J){switch(J.K){case 1:return q=g.yL(),Q=xvm(y),p=g.dY(Wue),g.EC(J,2),d={KO:!0},g.R(J,g.rY(q,Q,p,void 0,d),4);case 4:v=J.W;g.Hp(J,3);break;case 2:T=g.Rj(J);if(T instanceof g.Xl)throw O="GetOffline network manager error: "+T.message,pT(O,T),Error(O);pT("GetOffline fetch request error",T);throw Error("GetOffline fetch request error");case 3:w=Rv(v);if(!v)throw pT("Network request failed"),Error("Network request failed");if(w!==void 0)sF(w);else if(!v.videos||!v.videos.length)throw pT("No data"),
Error("No data");return J.return(v.videos.map(function(F){return F.offlineVideoData}))}})},tx_=function(y){var q,Q,p,v,d,T,O,w;
return g.M(function(J){switch(J.K){case 1:return q=g.yL(),Q=WCC(y),p=g.dY(Wue),g.EC(J,2),d={KO:!0},g.R(J,g.rY(q,Q,p,void 0,d),4);case 4:v=J.W;g.Hp(J,3);break;case 2:T=g.Rj(J);if(T instanceof g.Xl)throw O="GetOffline network manager error for playlist: "+T.message,pT(O,T),Error(O);pT("GetOffline fetch request error for playlist",T);throw Error("GetOffline fetch request error for playlist");case 3:w=Rv(v);if(!v)throw pT("Network request failed for playlist"),Error("Network request failed for playlist");
if(w!==void 0)sF(w,"playlist");else if(!v.playlists||!v.playlists.length)throw pT("No data for playlist"),Error("No data for playlist");return J.return(v.playlists.map(function(F){return F.offlinePlaylistData}))}})},kok=function(y,q,Q,p){var v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg;
return g.M(function(M9){switch(M9.K){case 1:return g.R(M9,y4(),2);case 2:v=M9.W;if(!v)return M9.return([]);d=[];if((T=p)==null?0:T.length){d=p;M9.ej(3);break}return g.R(M9,Ce(v,"mainPlaylistEntity"),4);case 4:d=M9.W;case 3:if(!d.length)return M9.return([]);O=[];w=Date.now()/1E3;J=g.t(d);F=J.next();case 5:if(F.done)return O.length?g.R(M9,E0c(O),10):M9.return([]);Y=F.value;if(!Y.downloadState){f=void 0;M9.ej(8);break}return g.R(M9,mp(v,Y.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:f=
M9.W;case 8:h=f;b=void 0;k=(Z=(b=Y)==null?void 0:b.entityMetadata)&&Z.nextAutoRefreshIntervalSeconds?Number(Z.nextAutoRefreshIntervalSeconds):NaN;S=Number.isNaN(k)?y:k;l=N=void 0;u=((N=h)==null?0:N.lastSyncedTimestampMillis)?Number((l=h)==null?void 0:l.lastSyncedTimestampMillis)/1E3:0;X=c=void 0;A=((c=h)==null?0:c.addedTimestampMillis)?Number((X=h)==null?void 0:X.addedTimestampMillis)/1E3:0;if(Q||!Z||u+S<=w){Tf=[];OC=void 0;if((OC=Y.videos)==null?0:OC.length)for(pS=g.t(Y.videos),YD=pS.next();!YD.done;YD=
pS.next())q9=YD.value,aj=JSON.parse(g.QX(q9).entityId),aj.videoId&&Tf.push(aj.videoId);Pp="0";Z&&(Fc=void 0,Pp=String(Number((Fc=Z.offlineLastModifiedTimestampSeconds)!=null?Fc:0).toFixed()));Jm={playlistId:Y.playlistId,videoIds:Tf,offlineLastModifiedTimestamp:Pp,autoSync:q,offlineDateAddedTimestamp:String(A.toFixed())};O.push(Jm)}F=J.next();M9.ej(5);break;case 10:return gg=M9.W,M9.return(gg)}})},LuC=function(){var y,q,Q,p,v;
return g.M(function(d){if(d.K==1)return g.R(d,y4(),2);if(d.K!=3)return(y=d.W)?g.R(d,Ce(y,"refresh"),3):d.return(!1);q=d.W;if((Q=q[0])==null||!Q.refreshTime)return d.return(!1);p=Number(q[0].refreshTime);v=Date.now()/1E3;return d.return(isFinite(p)&&v>=p)})},NPq=function(y,q){var Q,p,v;
return g.M(function(d){switch(d.K){case 1:return g.EC(d,2),g.R(d,aec(y,q),4);case 4:return p=d.W,g.R(d,v0C(p),5);case 5:Q=TPm(p);g.Hp(d,3);break;case 2:v=g.Rj(d),pT("getAndProcessSmartDownloadsResponse request or processing error",v);case 3:return d.return(Q)}})},Sa_=function(y,q,Q,p){var v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg;
return g.M(function(M9){switch(M9.K){case 1:return g.R(M9,y4(),2);case 2:v=M9.W;if(!v)return M9.return([]);d=[];if((T=p)==null?0:T.length){d=p;M9.ej(3);break}return g.R(M9,Ce(v,"musicPlaylist"),4);case 4:d=M9.W;case 3:if(!d.length)return M9.return([]);O=[];w=Date.now()/1E3;J=g.t(d);F=J.next();case 5:if(F.done)return O.length?g.R(M9,E0c(O),10):M9.return([]);Y=F.value;f=void 0;b=(h=(f=Y)==null?void 0:f.entityMetadata)&&h.nextAutoRefreshIntervalSeconds?Number(h.nextAutoRefreshIntervalSeconds):NaN;Z=
Number.isNaN(b)?y:b;S=k=0;N="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!Y.downloadMetadata){M9.ej(8);break}return g.R(M9,mp(v,Y.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:l=M9.W,c=u=void 0,k=Number((c=(u=l)==null?void 0:u.addedTimestampMillis)!=null?c:"0")/1E3,A=X=void 0,S=Number((A=(X=l)==null?void 0:X.lastModifiedTimestampMillis)!=null?A:"0")/1E3,OC=Tf=void 0,N=(OC=(Tf=l)==null?void 0:Tf.syncState)!=null?OC:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:pS=void 0;if(Q||N!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!h||Number((pS=h.lastSyncedTimestampSeconds)!=null?pS:0)+Z<=w){YD=[];q9=void 0;if((q9=Y.tracks)==null?0:q9.length)for(aj=g.t(Y.tracks),Pp=aj.next();!Pp.done;Pp=aj.next())Fc=Pp.value,YD.push(g.QX(Fc).entityId);Jm={playlistId:Y.playlistId,videoIds:YD,offlineLastModifiedTimestamp:String(S.toFixed()),autoSync:q,offlineDateAddedTimestamp:String(k.toFixed())};O.push(Jm)}F=J.next();M9.ej(5);break;case 10:return gg=M9.W,M9.return(gg)}})},aec=function(y,q){var Q,p,v,d,T,O,w,J,F,Y;
return g.M(function(f){switch(f.K){case 1:return Q=g.yL(),g.R(f,y4(),2);case 2:p=f.W;if(!p){f.ej(3);break}return g.R(f,NNu(p),4);case 4:v=f.W;case 3:var h=v;d={context:g.QT(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:y},offlineClientState:h,clientStateRequestData:{preferredFormatType:q}}}};T=g.dY(HXq);g.EC(f,5);w={KO:!0};return g.R(f,g.rY(Q,d,T,void 0,w),7);case 7:O=f.W;g.Hp(f,6);break;case 5:J=g.Rj(f);if(J instanceof g.Xl)throw F=
"DPS network manager error for smart downloads: "+J.message,pT(F,J),Error(F);pT("DPS fetch request error for smart downloads",J);throw Error("DPS fetch request error for smart downloads");case 6:Y=Rv(O);if(O)Y!==void 0&&sF(Y,"smart downloads");else throw pT("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return f.return(O)}})},spm=function(y,q){var Q,p,v,d,T,O,w,J;
return g.M(function(F){switch(F.K){case 1:return Q=g.yL(),p={context:g.QT(),videoPlaybackPositionEntities:y,lastSyncTimestampUsec:q},v=g.dY(Rec),g.EC(F,2),T={KO:!0},g.R(F,g.rY(Q,p,v,void 0,T),4);case 4:d=F.W;g.Hp(F,3);break;case 2:O=g.Rj(F);if(O instanceof g.Xl)throw w="VPPS network manager error: "+O.message,pT(w,O),Error(w);pT("VPPS fetch request error",O);throw Error("VPPS fetch request error");case 3:J=Rv(d);if(d)J!==void 0&&sF(J,"position sync");else throw pT("Network request failed for position sync"),
Error("Network request failed for position sync");return F.return(d)}})},leS=function(y,q,Q){var p,v,d,T,O,w,J,F;
return g.M(function(Y){switch(Y.K){case 1:p=g.yL();var f=Q.refreshData,h=Q.isEnqueuedForExpiredStreamUrlRefetch,b=Q.I9,Z=Q.offlineSourceData,k=Q.mediaCapabilities,S={entityKey:y};f&&(S.refreshData=f);h&&(S.isExpiredStreamUrlRefetch=h);b&&(S.downloadParameters=b);Z&&(S.offlineSourceData=Z);f={context:g.H4(q),signatureTimestamp:20340,videos:[S]};k&&(f.mediaCapabilities=k);v=f;d=g.dY(MxS);g.EC(Y,2);O={KO:!0};return g.R(Y,g.rY(p,v,d,void 0,O),4);case 4:T=Y.W;g.Hp(Y,3);break;case 2:w=g.Rj(Y);if(w instanceof
g.Xl)throw J="GetPDE network manager error: "+w.message,pT(J,w),Error(J);pT("GetPDE fetch request error",w);throw Error("GetPDE fetch request error");case 3:F=Rv(T);if(T)F!==void 0&&sF(F,"PDE");else throw pT("Network request failed for PDE"),Error("Network request failed for PDE");return Y.return(T)}})},Rv=function(y){var q;
return(q=y.errorMetadata)==null?void 0:q.status},sF=function(y,q){q=q?" for "+q:"";
if(y===0)throw y="Empty response body"+q,pT(y),Error(y);y="Response with error"+q;pT(y);throw Error(y);},E0c=function(y){var q,Q,p,v,d,T,O,w;
return g.M(function(J){switch(J.K){case 1:return q=g.yL(),Q=ZGe(y),p=g.dY(zeG),g.EC(J,2),d={KO:!0},g.R(J,g.rY(q,Q,p,void 0,d),4);case 4:v=J.W;g.Hp(J,3);break;case 2:T=g.Rj(J);if(T instanceof g.Xl)throw O="offlinePlaylistSyncCheck network manager error: "+T.message,pT(O,T),Error(O);pT("offlinePlaylistSyncCheck fetch request error",T);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:w=Rv(v);if(!v)throw pT("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(w!==void 0)sF(w,"playlist sync");else if(!v.offlinePlaylistSyncCheckDatas||!v.offlinePlaylistSyncCheckDatas.length)throw pT("No data for playlist sync"),Error("No data for playlist sync");return J.return(v.offlinePlaylistSyncCheckDatas.map(function(F){return F.offlinePlaylistSyncCheckData}))}})},Mh=function(y){this.K=y},Dn_=function(y,q){var Q,p,v,d,T,O;
return g.M(function(w){switch(w.K){case 1:Q=new Map,p=g.t(q),v=p.next();case 2:if(v.done){w.ej(4);break}d=v.value;T=Q;O=T.set;return g.R(w,y.W(d),5);case 5:O.call(T,d,w.W);v=p.next();w.ej(2);break;case 4:return w.return(Q)}})},lY=function(y,q,Q,p,v,d){q=g.po(q,Q);
p=Object.assign({},d,{priority:p,retryScheduleIntervalsInSeconds:v});return{actionType:y,entityKey:q,actionMetadata:p}},zC=function(y,q,Q,p,v,d){this.status=y;
this.K=q;this.Y=Q;this.W=p;this.N=v;this.downloadState=d},u4X=function(y,q,Q){this.K=y;
this.KK=q;this.N=Q},g0c=function(y,q){var Q,p,v,d,T,O,w,J,F;
return g.M(function(Y){switch(Y.K){case 1:return Q=q.entityKey,v=(p=g.U(q.actionMetadata,DS))==null?void 0:p.isEnqueuedForExpiredStreamUrlRefetch,g.EC(Y,2),d=void 0,g.R(Y,Ieu(y,q),4);case 4:d=Y.W;g.EC(Y,5);var f=(f=g.U(q.actionMetadata,DS))?{maximumDownloadQuality:f.maximumDownloadQuality}:void 0;return g.R(Y,leS(Q,y.KK,{isEnqueuedForExpiredStreamUrlRefetch:v,I9:f,offlineSourceData:d}),7);case 7:T=Y.W;g.Hp(Y,6,2);break;case 5:return g.Rj(Y,2),O=wE(q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",pT("PDE handleAdd error"),Y.return(uY(q,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",O,"DOWNLOAD_STATE_FAILED"));case 6:return g.R(Y,n0G(y,T,q),8);case 8:return Y.return(uY(q,!0,T.orchestrationActions));case 2:return w=g.Rj(Y),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.$C&&w.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),pT("PDE handleAdd error"),Y.return(uY(q,!1,void 0,J,F,"DOWNLOAD_STATE_FAILED"))}})},rAX=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC;
return g.M(function(pS){switch(pS.K){case 1:return Q=q.entityKey,p=g.QX(Q).entityId,g.R(pS,ii(y.K,{mode:"readonly",ij:!0},function(YD){var q9=r8(YD,Q,"playbackData"),aj=r8(YD,g.po(p,"offlineVideoPolicy"),"offlineVideoPolicy");YD=r8(YD,g.po(p,"transfer"),"transfer");return g.kC.all([q9,aj,YD])}),2);
case 2:v=pS.W;d=g.t(v);T=d.next().value;O=d.next().value;w=d.next().value;J=T;F=O;Y=w;if(!J||!F)return pS.return(uY(q,!0));f=[];Z=((b=J)==null?0:b.playerResponseJson)?JSON.parse(J.playerResponseJson):null;if(!(Y&&Z&&y.KK.L("html5_refresh_deprecated_downloads"))){pS.ej(3);break}h=cAm(y,Z,Y);return g.R(pS,Unc(y,Y),4);case 4:f=pS.W;case 3:k={lastPlayerResponseTimestampSeconds:J.playerResponseTimestamp,offlineToken:F.offlineToken,formatIds:f};S={};if((N=Y)==null?0:N.maximumDownloadQuality)S.maximumDownloadQuality=
Y.maximumDownloadQuality;g.EC(pS,5);l=void 0;return g.R(pS,Ieu(y,q),7);case 7:return l=pS.W,g.EC(pS,8),g.R(pS,leS(Q,y.KK,{refreshData:k,I9:S,offlineSourceData:l,mediaCapabilities:h}),10);case 10:u=pS.W;g.Hp(pS,9,5);break;case 8:return g.Rj(pS,5),c=wE(q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",pT("PDE handleRefresh error"),pS.return(uY(q,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",c,
"DOWNLOAD_STATE_FAILED"));case 9:return g.R(pS,n0G(y,u,q),11);case 11:return pS.return(uY(q,!0,u.orchestrationActions));case 5:return X=g.Rj(pS),A="PDE handleRefresh error",X instanceof Error&&(A="PDE handleRefresh error: "+X.message),Tf="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",OC="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.$C&&X.type==="QUOTA_EXCEEDED"&&(Tf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",OC="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
pT(A),pS.return(uY(q,!1,void 0,Tf,OC,"DOWNLOAD_STATE_FAILED"))}})},Ieu=function(y,q){var Q,p,v,d;
return g.M(function(T){if(T.K==1)return Q=g.QX(q.entityKey).entityId,p=g.po(Q,"videoDownloadContextEntity"),g.R(T,mp(y.K,p,"videoDownloadContextEntity"),2);v=T.W;return(d=v)!=null&&d.offlineModeType?T.return({offlineModeType:v.offlineModeType}):T.return(void 0)})},n0G=function(y,q,Q){var p,v,d,T,O;
return g.M(function(w){if(w.K==1){if(!q.frameworkUpdates||!g.U(q.frameworkUpdates,kL))return w.return();if(!(g.U(q.frameworkUpdates,kL).mutations&&g.U(q.frameworkUpdates,kL).mutations.length>0&&g.U(q.frameworkUpdates,kL).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return w.ej(2);p=g.QX(g.U(q.frameworkUpdates,kL).mutations[0].entityKey).entityId;return g.R(w,LT(y.K,p),3)}if(w.K!=2){v=w.W;d=g.U(Q.actionMetadata,DS);if(O=(T=d)==null?void 0:T.playlistId)v.playlistId=O;v.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Nj(y.KK)?g.R(w,EF(p,y.K,Q,y.N,v),2):g.Us(y.KK)?g.R(w,av(p,y.K,Q,y.N),2):w.ej(2)}return g.R(w,JSk(g.U(q.frameworkUpdates,kL)),0)})},uY=function(y,q,Q,p,v,d){return new zC(q?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",wE(y),Q,p,v,d)},cAm=function(y,q,Q){q=iG_(y.KK,Q.cotn,q);
Q=g.gx(q);return g.IHH(q,Q,y.KK)},Unc=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f;
return g.M(function(h){if(h.K==1)return Q=[],g.R(h,ii(y.K,{mode:"readonly",ij:!0},function(b){var Z=[],k=q.offlineVideoStreams;if(k){k=g.t(k);for(var S=k.next();!S.done;S=k.next())Z.push(r8(b,S.value,"offlineVideoStreams"))}return g.kC.all(Z)}),2);
if(p=h.W)for(v=g.t(p),d=v.next();!d.done;d=v.next())if(T=d.value,O=void 0,(O=T)==null?0:O.streamsProgress)for(w=T.streamsProgress,J=0;J<w.length;J++)F=w[J],Y=JSON.parse(F.formatStreamBytes),f={itag:Y.itag,lmt:Y.lastModified,xtags:Y.xtags},Q.push(f);return h.return(Q)})},o0m=function(y,q){this.K=y;
this.KK=q},AAS=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h;
return g.M(function(b){switch(b.K){case 1:return Q=wE(q),g.R(b,Ce(y.K,"videoPlaybackPositionEntity"),2);case 2:p=b.W;if(p.length===0)return b.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.EC(b,3);return g.R(b,g8.getInstance(),5);case 5:v=b.W;if(!v)throw Error("prefStorage is undefined");return g.R(b,v.get("psi"),6);case 6:return d=b.W,w=(O=(T=d)==null?void 0:T.f7)!=null?O:"0",g.R(b,spm(p,w),7);case 7:return J=b.W,F={isPaused:J.watchHistoryPaused,f7:J.syncTimestampUsec},g.R(b,v.set("psi",
F),8);case 8:if(F.isPaused){b.ej(9);break}Y=g.U(J.frameworkUpdates,kL);if(!J.frameworkUpdates||!Y){b.ej(9);break}return g.R(b,JSk(Y),9);case 9:g.Hp(b,4);break;case 3:return f=g.Rj(b),h="PPE handleRefresh error: "+(f instanceof Error?f.message:"unknown error"),pT(h),b.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return b.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},BPS=function(y,q){var Q,p,v,d,T,O,w,J;
return g.M(function(F){switch(F.K){case 1:return Q=wE(q),p=g.QX(q.entityKey).entityId,g.EC(F,2),g.R(F,g8.getInstance(),4);case 4:v=F.W;if(!v)throw Error("prefStorage is undefined");return g.R(F,v.get("psi"),5);case 5:d=F.W;T=g.U(q.actionMetadata,een);if(((O=d)==null?void 0:O.isPaused)!==!1||(w=T)==null||!w.lastPlaybackPositionSeconds){F.ej(6);break}J={key:g.po(p,"videoPlaybackPositionEntity"),videoId:p,lastPlaybackPositionSeconds:T.lastPlaybackPositionSeconds};return g.R(F,XC(y.K,J,"videoPlaybackPositionEntity"),
6);case 6:g.Hp(F,3);break;case 2:return g.Rj(F),F.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},Go_=function(y,q){var Q,p,v;
return g.M(function(d){switch(d.K){case 1:Q=wE(q);g.EC(d,2);p=g.QX(q.entityKey).entityId;if(p==="!*$_ALL_ENTITIES_!*$")return g.R(d,dvw(y.K),5);v=g.po(p,"videoPlaybackPositionEntity");return g.R(d,v9q(y.K,v),5);case 5:g.Hp(d,3);break;case 2:return g.Rj(d),d.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},P6S=function(y,q){this.api=y;
this.K=q;this.logger=new g.L5("woffle");this.W=!1;this.je={xP:this.xP}},iXS=function(y){return g.M(function(q){return q.return(KCC(y))})},XHu=function(y){var q;
return g.M(function(Q){if(Q.K==1)return g.R(Q,g.jSp(y),2);q=Q.W;return Q.return(q.filter(function(p){return!!p.url}).map(function(p){return p.url}))})},Iv=function(y,q){var Q=g.OB(q);
if(Q===1||Q===0)return Promise.resolve();(Q=mnc(y,q))&&Q.stopVideo();y.N=0;return iXS(q)},nT=function(y,q,Q,p){Q=Q===void 0?!1:Q;
p=p===void 0?!0:p;q=typeof q==="string"?q:q.videoDetails.videoId;if(g.OB(q)===2){var v=mnc(y,q);v&&v.stopVideo();g.wx(q,2);y.N=2;Q?C6m(y.K):p&&yrc(y.K)}},mnc=function(y,q){var Q;
return((Q=y.player)==null?void 0:Q.getVideoData().videoId)===q?y.player:null},q$q=function(y,q){this.K=y;
this.KK=q},Q4k=function(y,q){var Q,p;
return g.M(function(v){switch(v.K){case 1:return Q=wE(q),g.R(v,mp(y.K,q.entityKey,"transfer"),2);case 2:if(p=v.W)return v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.EC(v,3);return g.R(v,j4e(y,q),5);case 5:g.Hp(v,4);break;case 3:return g.Rj(v),v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},pOw=function(y,q){var Q,p;
return g.M(function(v){switch(v.K){case 1:return Q=wE(q),g.R(v,mp(y.K,q.entityKey,"transfer"),2);case 2:p=v.W;if(!p||p.transferState!=="TRANSFER_STATE_COMPLETE")return v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.EC(v,3);return g.R(v,j4e(y,q,!0),5);case 5:g.Hp(v,4);break;case 3:return g.Rj(v),v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},vy_=function(y,q){var Q,p,v,d,T,O,w,J,F,Y;
return g.M(function(f){switch(f.K){case 1:return Q=wE(q),p=g.QX(q.entityKey).entityId,g.R(f,ii(y.K,{mode:"readonly",ij:!0},function(h){var b=r8(h,q.entityKey,"transfer");h=r8(h,g.po(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.kC.all([b,h])}),2);
case 2:v=f.W;d=g.t(v);T=d.next().value;O=d.next().value;w=T;J=O;if(!w||w.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return f.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.EC(f,3);w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.R(f,XC(y.K,w,"transfer"),5);case 5:F=g.QX(w.key).entityId;o9_({videoId:F,Hx:w,offlineModeType:(Y=J)==null?void 0:Y.offlineModeType});g.Hp(f,4);break;case 3:return g.Rj(f),f.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return f.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},j4e=function(y,q,Q){Q=Q===void 0?!1:Q;
var p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S;return g.M(function(N){switch(N.K){case 1:return p=g.U(q.actionMetadata,dMh),v=g.QX(q.entityKey).entityId,d=g.po(v,"downloadStatusEntity"),g.R(N,ii(y.K,{mode:"readonly",ij:!0},function(l){var u=r8(l,d,"downloadStatusEntity");l=r8(l,g.po(v,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.kC.all([u,l])}),2);
case 2:return T=N.W,O=g.t(T),w=O.next().value,J=O.next().value,F=w,Y=J,f="TRANSFER_STATE_TRANSFER_IN_QUEUE",((h=F)==null?void 0:h.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(f="TRANSFER_STATE_PAUSED_BY_USER"),k={key:q.entityKey,transferState:f,cotn:g.ZX(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(b=p)==null?void 0:b.maximumDownloadQuality,preferredAudioTrack:(Z=p)==null?void 0:Z.preferredAudioTrack,transferRetryCount:0,isRefresh:Q,hasLoggedFirstStarted:!1},g.R(N,ii(y.K,
{mode:"readwrite",ij:!0},function(l){var u=[];Q&&u.push(B7(l,g.po(v,"offlineVideoStreams")));u.push(eq(l,k,"transfer"));return g.kC.all(u)}),3);
case 3:if(!Q){N.ej(4);break}return g.R(N,iXS(v),4);case 4:Uvq({videoId:v,Hx:k,offlineModeType:(S=Y)==null?void 0:S.offlineModeType}),g.tH(N)}})},V4w=function(y,q,Q,p){if(!y.action.entityKey)throw Error("entityKey is missing.");
var v=g.QX(y.action.entityKey);v={entityType:v.O6,entityId:v.entityId,offlineOrchestrationActionType:y.action.actionType,orchestrationAction:{orchestrationActionId:y.actionId}};q&&(v.offlineOrchestrationActionResult=q.status,v.isRetryable=Q?!1:q.K,q.N&&(v.offlineOrchestrationFailureReason=Tlm(q.N,v.isRetryable)));var d,T;if((d=y.action.actionMetadata)==null?0:(T=d.offlineLoggingData)==null?0:T.offlineModeType)v.offlineModeType=y.action.actionMetadata.offlineLoggingData.offlineModeType;p&&(v.additionalOrchestrationActions=
p.map(function(O){return{orchestrationActionId:O.actionId}}));
return v},Tlm=function(y,q){return y!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||q?y==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&q?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":y:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},OUc=function(y,q){var Q={offlineOrchestrationContext:V4w(y)};
q=LCu(q,Q);aMm(kQu(),q,y.rootActionId)},wOe=function(y,q,Q,p){p=p===void 0?[]:p;
q={offlineOrchestrationContext:V4w(y,q,Q,p)};q=LCu(3,q);aMm(kQu(),q,y.rootActionId)},Jru=function(){this.actions=[]},FOh=function(y,q){q=g.t(q);
for(var Q=q.next();!Q.done;Q=q.next())Q=Q.value,OUc(Q,1),y.actions.push(Q);y.actions.sort(y.K)},Y$n=function(y,q){if(q)for(var Q=0;Q<y.actions.length;Q++)if(q==="!*$_ALL_ENTITIES_!*$"&&y.actions[Q].actionId!==q||q!=="!*$_ALL_ENTITIES_!*$"&&y.actions[Q].rootActionId===q&&y.actions[Q].actionId!==q)y.actions.splice(Q,1),Q--},ffm=function(y,q){y=g.t(y.actions);
for(var Q=y.next();!Q.done;Q=y.next())if(Q.value.actionId===q)return!0;return!1},gE=function(y,q,Q,p,v){g.I.call(this);
var d=this;this.W=y;this.m3=q;this.cI=Q;this.X=p;this.KK=v;this.K=new Jru;this.G=new g.eB;this.N=new g.y0(function(){d.retry()});
this.C=NaN;this.J=!1;this.je={iqK:function(){return d.K},
vX:function(){return d.G},
xEs:function(){return d.N},
retry:function(){return d.retry()}};
g.n(this,this.N);this.j=this.W.observe(this.N$.bind(this))},$MX=function(y,q,Q,p,v){var d;
return g.M(function(T){if(T.K==1)return d=new gE(y,q,Q,p,v),g.R(T,hrq(d),2);bUm(d);return T.return(d)})},bUm=function(y){var q=y.K.actions[0];
return y.Y?((q==null?void 0:q.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&y.Y[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(y.J=!0),Promise.resolve()):KOe(y)},KOe=function(y){var q,Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S;
return g.M(function(N){switch(N.K){case 1:if(y.Y)throw Error("Already processing an action");if(y.iB())return N.return();q=y.K.actions.shift();g9m(y.cI,!q);if(q===void 0)return N.return();q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&q.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&Y$n(y.K,q.actionId);Q="";q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&q.rootActionId===q.actionId&&(Q=q.actionId);p=[q];y.Y=p;if(v=y.m3[q.entityType]){N.ej(2);break}y.Y=
void 0;return g.R(N,KOe(y),3);case 3:return N.return();case 2:d=g.t(p);for(T=d.next();!T.done;T=d.next())O=T.value,OUc(O,2);g.EC(N,4,5);return g.R(N,Dn_(v,p.map(function(l){return l.action})),7);
case 7:w=N.W,J=g.t(p),F=J.next();case 8:if(F.done){N.ej(10);break}Y=F.value;f=w.get(Y.action);return g.R(N,xMm(y,Y,f),9);case 9:F=J.next();N.ej(8);break;case 10:Y$n(y.K,Q);case 5:g.l8(N);y.Y=void 0;g.zf(N,6);break;case 4:return h=g.Rj(N),pT("Orchestration error",h),g.EC(N,12),g.R(N,WO_(y,p),14);case 14:g.Hp(N,5);break;case 12:b=g.Rj(N);pT("Orchestration retry error",b);Z=g.t(p);for(k=Z.next();!k.done;k=Z.next())S=k.value,S.retryScheduleIndex<3&&FOh(y.K,[S]);N.ej(5);break;case 6:return g.R(N,KOe(y),
0)}})},xMm=function(y,q,Q){var p,v,d,T,O,w,J,F,Y,f,h,b;
return g.M(function(Z){switch(Z.K){case 1:p=q.retryScheduleIndex+2===3;if(Q.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Z.ej(2);break}if(Q.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Z.ej(0);break}wOe(q,Q,p);if(Q.K&&q.retryScheduleIndex+1<3)return g.R(Z,WO_(y,[q]),0);d=((v=Q)==null?0:v.W)?Q.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";T={entityKey:q.action.entityKey,failureReason:d};O=void 0;g.Nj(y.KK)?O="mainVideoDownloadStateEntity":g.Us(y.KK)&&(O="musicTrackDownloadMetadataEntity");
if(!O||!Q.downloadState){Z.ej(7);break}w=g.QX(q.action.entityKey).entityId;return g.R(Z,fT(w,O,y.W,Q.downloadState),7);case 7:dE(y.X,T);if(Q.downloadState==="DOWNLOAD_STATE_FAILED"&&y.KK.L("html5_auto_retry_failed_pde_actions")){Z.ej(0);break}pT("Orchestration result is not retryable, deleting action");return g.R(Z,v9q(y.W,WR(q).key),0);case 2:J=void 0;try{J=(F=Q.Y)==null?void 0:F.map(function(k){return y.createAction(k,q)})}catch(k){return wOe(q,Q,p),Y={entityKey:q.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},dE(y.X,Y),pT("Orchestration subactions creation error",k),Z.return()}wOe(q,Q,p,J);if(!J){Z.ej(12);break}f=J.map(function(k){return WR(k)});
h=0;case 13:if(!(h<J.length)||y.J){Z.ej(15);break}return g.R(Z,ii(y.W,{mode:"readwrite",ij:!0},function(k){var S=[];S.push(Pun(k,f.slice(h,h+10),"offlineOrchestrationActionWrapperEntity"));return g.kC.all(S)}),16);
case 16:h+=10;Z.ej(13);break;case 15:if(y.J)return y.J=!1,Z.return();case 12:return b=WR(q),g.R(Z,v9q(y.W,b.key),17);case 17:OUc(q,4),g.tH(Z)}})},k9m=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h;
return g.M(function(b){Q=[];p=Infinity;v=4E3;d=g.t(q);for(T=d.next();!T.done;T=d.next())O=T.value,w=Number(O.enqueueTimeSec),J=ZUk(w),F=O.retryScheduleIndex,Y=F!=null&&F>0,J>0&&Y?(p=Math.min(p,w),v=Math.min(J,v)):Q.push(O);isFinite(p)&&(!y.N.isActive()||p<y.C)&&(y.C=p,y.N.start(v));y.G.rh()||(f=Q.length,Q=Q.filter(function(Z){var k;Z=((k=Z.actionProto)==null?void 0:k.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!t4_.includes(Z)}),h=Q.length<f,!y.N.isActive()&&h&&y.N.start(1));
Q.length>0&&Eyq(y,Q);return g.R(b,bUm(y),0)})},afh=function(y){var q,Q,p,v,d,T,O;
return g.M(function(w){if(w.K==1)return g.R(w,LOm(y),2);q=w.W;Q=[];p=g.t(q);for(v=p.next();!v.done;v=p.next())d=v.value,T=g.QX(d.key),O=T.entityId,ffm(y.K,O)||Q.push(d);return g.R(w,k9m(y,Q),0)})},ZUk=function(y){y=y*1E3-Date.now();
return y>4E3?4E3:y},WO_=function(y,q){var Q,p,v;
return g.M(function(d){Q=g.t(q);for(p=Q.next();!p.done;p=Q.next()){v=p.value;var T=void 0,O=void 0,w=((O=v.action)==null?void 0:(T=O.actionMetadata)==null?void 0:T.retryScheduleIntervalsInSeconds)||[1,2,4];T=1;v.retryScheduleIndex<w.length&&(T=w[v.retryScheduleIndex]);v.K=T*1E3+Date.now();v.retryScheduleIndex++}return g.R(d,Nlc(y,q),0)})},hrq=function(y){var q;
return g.M(function(Q){if(Q.K==1)return g.R(Q,Ce(y.W,"offlineOrchestrationActionWrapperEntity"),2);q=Q.W;return g.R(Q,k9m(y,q),0)})},Eyq=function(y,q){q.length!==0&&q.forEach(function(Q){Q=xL(Q);
Q.retryScheduleIndex<3&&FOh(y.K,[Q])})},LOm=function(y,q){var Q;
return g.M(function(p){if(p.K==1)return g.R(p,Ce(y.W,"offlineOrchestrationActionWrapperEntity",q),2);Q=p.W;return p.return(Q.filter(FCw))})},Nlc=function(y,q){if(q.length===0)return Promise.resolve([]);
q=q.map(function(Q){return WR(Q)});
return pwn(y.W,q)},S$c=function(y){this.xf=y;
this.K=void 0},HUm=function(y,q){var Q,p,v,d;
return g.M(function(T){Q=q.videoId;p=!0;if(q.captionTracks.length)v=cvc(q),y.K=new g.SW(y.xf,q,v);else if(q.zf)d=g.OZi(q),y.K=new g.RH(y.xf,q.zf,Q,d,q.TB,q.eventId),p=q.TB;else return T.return();return T.return(new Promise(function(O){var w;(w=y.K)==null||w.NN({zL:function(){return g.M(function(J){if(J.K==1)return g.R(J,y.zL(Q,p),2);O();g.tH(J)})},
rI:function(){}})}))})},Rrm=function(y){var q;
return g.M(function(Q){if(Q.K==1)return g.R(Q,$vC(y),2);q=Q.W;return Q.return(!!q&&q.length>0)})},cR=function(y){g.I.call(this);
this.K=y;this.W=this.K.observe(this.N.bind(this))},s4h=function(y,q){var Q,p,v,d,T,O,w;
return g.M(function(J){switch(J.K){case 1:if(q.length===0)return J.return([]);Q=q.map(function(F){return g.po(F,"transfer")});
return g.R(J,Ce(y.K,"transfer",Q),2);case 2:p=J.W;v=p.filter(FCw).map(function(F){return g.QX(F.key).entityId});
d=q.filter(function(F){return v.indexOf(F)===-1});
if(d.length===0)return J.return([]);T=g.t(d);O=T.next();case 3:if(O.done){J.ej(5);break}w=O.value;return g.R(J,iXS(w),4);case 4:O=T.next();J.ej(3);break;case 5:return J.return(d)}})},zrc=function(y,q,Q,p,v,d){var T,O,w;
return g.M(function(J){T="STREAM_TYPE_UNKNOWN";Q.video&&Q.audio?(T="STREAM_TYPE_AUDIO_AND_VIDEO",pT("unexpected stream type")):Q.video&&!Q.audio?T="STREAM_TYPE_VIDEO":!Q.video&&Q.audio&&(T="STREAM_TYPE_AUDIO");O=g.po(q,"offlineVideoStreams");w={numBytesDownloaded:v.toFixed(),numTotalBytes:d.toFixed(),streamType:T,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(p),itag:T==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Q.itag):void 0};return g.R(J,ii(y,{mode:"readwrite",ij:!0},
function(F){var Y=r8(F,O,"offlineVideoStreams"),f=r8(F,g.po(q,"transfer"),"transfer");return g.kC.all([Y,f]).then(function(h){h=g.t(h);var b=h.next().value;h=h.next().value;if(!h)return B7(F,O).then(function(){});
var Z=M4S(b);b=lfq(b,p,w,O);var k=eq(F,b,"offlineVideoStreams");M4S(b)>Z&&(h.lastProgressTimeMs=Date.now().toString());Z=[k];h.offlineVideoStreams||(h.offlineVideoStreams=[]);h.offlineVideoStreams.indexOf(O)===-1&&(h.offlineVideoStreams.push(O),Z.push(eq(F,h,"transfer")));return g.kC.all(Z)})}),0)})},DMk=function(y,q){var Q,p,v,d,T;
return g.M(function(O){if(O.K==1)return Q=g.po(q,"offlineVideoStreams"),g.R(O,mp(y,Q,"offlineVideoStreams"),2);p=O.W;if(!p||!p.streamsProgress)return O.return();v=g.t(p.streamsProgress);for(d=v.next();!d.done;d=v.next())T=d.value,T.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",T.numTotalBytes!==T.numBytesDownloaded&&(T.numBytesDownloaded=T.numTotalBytes);return g.R(O,XC(y,p,"offlineVideoStreams"),0)})},lfq=function(y,q,Q,p){if(y&&y.streamsProgress){p=y;
a:{q=q.itag+";"+q.xtags;for(var v=y.streamsProgress,d=0;d<v.length;d++){var T=JSON.parse(v[d].formatStreamBytes);if(T.itag+";"+T.xtags===q){v[d]=Q;Q=v;break a}}v.push(Q);Q=v}p.streamsProgress=Q}else y={key:p,streamsProgress:[Q]};return y},M4S=function(y){if(y==null?0:y.streamsProgress){var q=0;
y=y.streamsProgress;for(var Q=0;Q<y.length;Q++){var p=y[Q];isNaN(Number(p.numBytesDownloaded))?pT("stream progress bytes number invalid"):q+=Number(p.numBytesDownloaded)}return q}return 0},unm=function(y,q,Q,p){g.I.call(this);
var v=this;this.W=y;this.api=q;this.Vm=Q;this.N$=p;this.G=new g.eB;this.Y=new g.y0(function(){v.K&&v.K.transferState==="TRANSFER_STATE_TRANSFERRING"&&v.G.rh()&&((v.K.transferRetryCount||0)<3?nT(v.X,v.J,!1,!1):Iv(v.X,v.J.videoDetails.videoId),v.Bd("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.cI=this.gp=0;this.j=this.C=!1;this.HI=g.wm(this.api.T().experiments,"html5_transfer_processing_logs_interval");this.LK=new g.sU(this);this.je={zYK:function(){return v.Y},
glV:function(){return v.N$},
vX:function(){return v.G}};
this.m3=this.W.observe(this.ZH.bind(this));this.X=new P6S(q,this);this.Ty=new S$c(q);this.Sj=new cR(this.W);this.vI=this.G.listen("publicytnetworkstatus-online",this.wb.bind(this));this.Es=this.G.listen("publicytnetworkstatus-offline",this.gkK.bind(this));this.j=this.api.T().L("html5_less_transfer_processing_logs");g.n(this,this.LK);this.LK.Z(q,"offlinetransferpause",this.y1V);if(g.Nj(this.api.T()))this.N="mainVideoDownloadStateEntity";else if(g.Us(this.api.T())||g.Hr(this.api.T()))this.N="musicTrackDownloadMetadataEntity"},
Ifm=function(y){return g.M(function(q){if(q.K==1)q=g.R(q,hLe(),2);
else{var Q=y.Sj;var p=g.VQ();p=Object.keys(p);Q=s4h(Q,p);q=g.R(q,Q,0)}return q})},rE=function(y,q){q=q===void 0?!1:q;
var Q;return g.M(function(p){if(p.K==1){if(y.K)throw Error("Already downloading a video");y.cI=0;y.C=!1;return g.R(p,nyu(y),2)}return p.K!=4?(Q=p.W,cSq(y.Vm,!Q),Q&&y.G.rh()?q?g.R(p,new Promise(function(v){g.xQ(v,1E3)}),4):p.ej(4):(!Q&&y.K&&UF(y),p.ej(0))):g.R(p,gyC(y,Q),0)})},crc=function(y){return g.M(function(q){if(q.K==1)return y.J?g.R(q,Iv(y.X,y.J.videoDetails.videoId),3):q.ej(0);
UF(y);g.tH(q)})},UMu=function(y,q){var Q,p,v;
return g.M(function(d){switch(d.K){case 1:return g.EC(d,2),(Q=!!q.captionTracks.length||!!q.zf)?g.R(d,Rrm(q.videoId),4):d.return();case 4:return(p=d.W)?d.return():g.R(d,HUm(y.Ty,q),5);case 5:g.Hp(d,0);break;case 2:v=g.Rj(d),pT("Caption downloading error",v,q.cotn),g.tH(d)}})},gyC=function(y,q){var Q,p,v,d,T,O;
return g.M(function(w){switch(w.K){case 1:if(y.C)return w.return();y.C=!0;y.K=q;Q=g.QX(y.K.key);p=Q.entityId;v=void 0;if(y.K.transferState==="TRANSFER_STATE_TRANSFERRING")return g.R(w,ov(y,p),7);if(y.K.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||y.K.transferRetryCount||y.K.hasLoggedFirstStarted){w.ej(3);break}return g.R(w,ov(y,p),5);case 5:return v=w.W,y.K.hasLoggedFirstStarted=!0,g.R(w,rre(y),6);case 6:rSc({videoId:p,Hx:y.K,offlineModeType:v},void 0,void 0,!0);w.ej(3);break;case 7:v=w.W,
OF({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:p,Hx:y.K,offlineModeType:v});case 3:return g.R(w,oyc(y),8);case 8:return d=null,g.EC(w,9),g.R(w,ArX(y,q),11);case 11:d=w.W;y.J=d;g.Hp(w,10);break;case 9:return T=g.Rj(w),pT("error getting player response",T,q.cotn),g.R(w,y.Bd("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return w.return();case 10:return O=iG_(y.api.T(),q.cotn,d),g.R(w,UMu(y,O),13);case 13:return g.R(w,XHu(O.videoId),
14);case 14:O.iC=w.W;var J=y.X,F=O,Y=q.maximumDownloadQuality;F.getPlayerResponse();g.wx(F.videoId,2);J.N=2;J.W=!1;var f;(f=J.player)==null||f.dispose();J.player=J.api.lW(F);F={};J.player.b7((F.localmediachange=J.X6,F.signatureexpired=J.fp,F.statechange=J.H3b,F),J);J.L("html5_generate_content_po_token")&&J.player.QH();Y=J.xP(Y);J.player.iN(g.lH(Y,Y,!0,"m"),!1);J.player.Jl(!1);y.Y.start(108E5);g.tH(w)}})},nyu=function(y){var q,Q;
return g.M(function(p){if(p.K==1)return g.R(p,Ce(y.W,"transfer"),2);q=p.W;Q=q.filter(erC).sort(BlC);return Q.length===0?p.return():p.return(Q[0])})},oyc=function(y){var q,Q,p;
return g.M(function(v){if(v.K==1){if(!y.K)return Au(y,"onTransferStart"),v.return();y.Y.start(108E5);return g.R(v,eN(y,"TRANSFER_STATE_TRANSFERRING"),2)}q=y.K;return(p=((Q=q)==null?0:Q.key)?g.QX(q.key).entityId:"")&&y.N?g.R(v,fT(p,y.N,y.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):v.ej(0)})},C6m=function(y){var q,Q,p,v;
g.M(function(d){switch(d.K){case 1:if(!y.K){Au(y,"onTransferPausedByUser");d.ej(2);break}q=y.K;y.Y.stop();return g.R(d,eN(y,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:p=((Q=q)==null?0:Q.key)?g.QX(q.key).entityId:"";if(!p||!y.N){d.ej(4);break}return g.R(d,fT(p,y.N,y.W,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.R(d,ov(y,p),6);case 6:v=d.W,ASG({videoId:p,Hx:q,offlineModeType:v});case 2:UF(y),rE(y),g.tH(d)}})},yrc=function(y){var q,Q,p;
g.M(function(v){if(v.K==1){if(!y.K)return Au(y,"onTransferPausedByNetwork"),v.return();y.Y.stop();return g.R(v,eN(y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(v.K!=3)return q=y.K,(p=((Q=q)==null?0:Q.key)?g.QX(q.key).entityId:"")&&y.N?g.R(v,fT(p,y.N,y.W,"DOWNLOAD_STATE_PAUSED"),3):v.ej(3);UF(y);g.tH(v)})},G9u=function(y){var q,Q,p,v,d;
g.M(function(T){switch(T.K){case 1:if(!y.K)return Au(y,"onTransferComplete"),T.return();q=y.K;y.Y.stop();if(!q||!y.J){T.ej(2);break}Q=iG_(y.api.T(),q.cotn,y.J);return g.R(T,UMu(y,Q),2);case 2:return g.R(T,eN(y,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:v=((p=q)==null?0:p.key)?g.QX(q.key).entityId:"";if(!v||!y.N){T.ej(5);break}return g.R(T,fT(v,y.N,y.W,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.R(T,DMk(y.W,v),7);case 7:return g.R(T,ov(y,v),8);case 8:d=T.W,OF({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:v,Hx:q,offlineModeType:d}),UF(y),rE(y),g.tH(T)}})},PxS=function(y,q,Q){var p,v;
g.M(function(d){switch(d.K){case 1:if(!y.K)return Au(y,"onTransferProgress: "+q),d.return();if(y.K.transferState==="TRANSFER_STATE_TRANSFERRING"){d.ej(2);break}return g.R(d,oyc(y),2);case 2:p=Date.now();if(!(p-y.gp>1E3)){d.ej(4);break}y.gp=p;return g.R(d,zrc(y.W,Q.videoId,Q.W,Q.SZ,Q.bytesDownloaded,Q.K),5);case 5:if(y.j&&!(y.j&&p-y.cI>y.HI)){d.ej(4);break}y.cI=p;return g.R(d,ov(y,q),7);case 7:v=d.W,rSc({videoId:q,Hx:y.K,offlineModeType:v},Q.bytesDownloaded,Q.K);case 4:y.Y.start(108E5),g.tH(d)}})},
iUh=function(y){var q=(y.K.transferRetryCount||0)<3;
q&&(y=y.K,y.transferRetryCount=(y.transferRetryCount||0)+1);return q},XOX=function(y,q){q=q===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":q;
var Q,p,v,d;return g.M(function(T){if(T.K==1)return y.K||Au(y,"setTransferToFailed: "+q),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q==="TRANSFER_FAILURE_REASON_NETWORK"?Q="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":q==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.R(T,eN(y,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",q),2);if(T.K!=3)return dE(y.N$,{entityKey:(p=y.K)==null?void 0:p.key,failureReason:Q}),
v=y.K?g.QX(y.K.key).entityId:"",g.R(T,ov(y,v),3);d=T.W;var O={videoId:v,Hx:y.K,offlineModeType:d},w=q,J={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};w&&(J.transferFailureReason=w,J.failureReason=eLc(w));OF(J,O);g.tH(T)})},eN=function(y,q,Q,p){var v;
return g.M(function(d){if(d.K==1){if(!y.K)return Au(y,"saveTransferState: "+q),d.return();y.K.transferState=q;y.K.failureReason=p;g.EC(d,2);return g.R(d,rre(y,function(T){return Q?o7(T,"offlineVideoStreams",y.K.offlineVideoStreams).then(function(O){for(var w=g.t(O),J=w.next();!J.done;J=w.next())if((J=J.value)&&J.streamsProgress){J=g.t(J.streamsProgress);for(var F=J.next();!F.done;F=J.next())F.value.streamState=Q}return Pun(T,O.filter(function(Y){return!!Y}),"offlineVideoStreams")}):g.kC.resolve(void 0)}),
4)}if(d.K!=2)return g.Hp(d,0);
v=g.Rj(d);return v instanceof g.$C&&v.type==="QUOTA_EXCEEDED"?g.R(d,y.Bd("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):d.ej(0)})},rre=function(y,q){var Q;
return g.M(function(p){if(!y.K)return p.return();Q=y.K;return g.R(p,ii(y.W,{mode:"readwrite",ij:!0},function(v){var d=[eq(v,Q,"transfer")];q&&d.push(q(v));return g.kC.all(d)}),0)})},UF=function(y){y.K=void 0;
y.J=void 0;y.Y.stop()},ArX=function(y,q){var Q,p,v,d,T;
return g.M(function(O){if(O.K==1)return Q=g.QX(q.key),p=Q.entityId,v=g.po(p,"playbackData"),g.R(O,mp(y.W,v,"playbackData"),2);d=O.W;if((T=d)==null?0:T.playerResponseJson)return O.return(JSON.parse(d.playerResponseJson));throw Error("No PlayerResponse found");})},Au=function(y,q){y.api.Rb("woffle",{mcte:q});
pT("missing current transfer entity.")},ov=function(y,q){var Q,p,v;
return g.M(function(d){if(d.K==1)return g.R(d,mp(y.W,g.po(q,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Q=d.W;return d.return((v=(p=Q)==null?void 0:p.offlineModeType)!=null?v:void 0)})},erC=function(y){return mMm[y.transferState]!==void 0},BlC=function(y,q){var Q=mMm[y.transferState],p=mMm[q.transferState];
return Q!==p?Q-p:Number(y.enqueuedTimestampMs)-Number(q.enqueuedTimestampMs)},BR=function(y,q){var Q=this;
this.KK=y;this.api=q;this.G=new g.eB;this.J=new g.$9;this.je={J_:function(){return Q.N.je.J_()},
vX:function(){return Q.G},
ylK:function(){return Q.N},
kI:function(){return Q.kI()},
Wo:function(){return Q.Wo()},
YF:function(){return Q.YF()},
J3:function(){return Q.J3()},
ww:function(){return Q.ww()},
NP:function(p){return Q.NP(p)}};
this.N=new uoe(function(){return Cx_(Q)},function(){Q.YF()},this.api.G5(),this.api.L.bind(this.api));
this.K=new vR(this.api);IMq(this.N)},Cx_=function(y){return g.M(function(q){y.api.AK("onOrchestrationBecameLeader");
return g.R(q,y.Wo(),0)})},qew=function(y){var q,Q;
return g.M(function(p){if(p.K==1)return g.R(p,y4(),2);if(p.K!=3){q=p.W;if(!q)return pT("PES is undefined"),p.return();y.W=new unm(q,y.api,y.N,y.K);Q=y.QX(q);return g.R(p,$MX(q,Q,y.N,y.K,y.KK),3)}y.X=p.W;return g.R(p,ytc(y),0)})},ytc=function(y){var q;
return g.M(function(Q){switch(Q.K){case 1:if(!y.W)return pT("transferManager is undefined"),Q.return();if(y.W.K){Q.ej(2);break}return g.R(Q,rE(y.W),2);case 2:if(!y.KK.L("woffle_enable_main_downloads_library")){Q.ej(4);break}return g.R(Q,y.wz(),4);case 4:if(!y.KK.L("html5_offline_playback_position_sync")){Q.ej(6);break}return g.R(Q,y.Hm(),7);case 7:return g.R(Q,y.NP(864E5),6);case 6:return g.R(Q,y.refreshAllStaleEntities(43200,!0),9);case 9:return g.R(Q,y.YL(),10);case 10:if(!y.KK.L("html5_retry_downloads_for_expiration")){Q.ej(11);
break}return g.R(Q,y.ww(),11);case 11:return y.C=g.WF(function(){y.refreshAllStaleEntities(43200,!0);y.YL()},9E5),g.C_(g.qb(),function(){return y.J3()}),g.R(Q,y4(),13);
case 13:return q=Q.W,g.R(Q,Dvm(q),14);case 14:n9u(y.N),g.tH(Q)}})},j3k=function(){var y,q,Q,p,v,d;
return g.M(function(T){switch(T.K){case 1:return g.R(T,y4(),2);case 2:y=T.W;if(!y)return T.return([]);q=Date.now()/1E3;return g.R(T,Ce(y,"offlineVideoPolicy"),3);case 3:Q=T.W,p=g.t(Q),v=p.next();case 4:if(v.done){T.ej(6);break}d=v.value;if(!(d.expirationTimestamp&&Number(d.expirationTimestamp)<q)){T.ej(5);break}d.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";d.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.R(T,XC(y,d,"offlineVideoPolicy"),5);
case 5:v=p.next();T.ej(4);break;case 6:return T.return(Q.map(function(O){return O.key}))}})},GC=function(y,q,Q,p,v){var d,T,O;
return g.M(function(w){if(w.K==1)return g.R(w,y4(),2);d=w.W;if(!d)return w.return([]);T=q.map(function(J){var F=g.po(J,Q);F={actionType:p,entityKey:F,actionMetadata:Object.assign({},Xwm(),v)};p!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(F.actionMetadata.priority=0);J=new KT(Q,J,F);return WR(J)});
O=pwn(d,T);IMq(y.N);return w.return(O)})},Q3C=function(y,q,Q,p){var v,d,T,O,w,J,F,Y;
return g.M(function(f){switch(f.K){case 1:v=[],d=g.t(q),T=d.next();case 2:if(T.done){f.ej(4);break}O=T.value;if(O.upToDate||Q&&!O.shouldAutoSyncMetadata||!O.playlistId){f.ej(3);break}w={};switch(p){case "mainPlaylistEntity":J={nextAutoRefreshIntervalSeconds:O.checkInSeconds,autoSync:Q};w={mainPlaylistEntityActionMetadata:J};break;case "musicPlaylist":F={autoSync:Q},w={musicPlaylistEntityActionMetadata:F}}return g.R(f,GC(y,[O.playlistId],p,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w),6);case 6:(Y=
f.W)&&v.push.apply(v,g.hH(Y));case 3:T=d.next();f.ej(2);break;case 4:return f.return(v)}})},pAh=function(y,q){var Q;
return g.M(function(p){return q.length?(Q=Xwm(),g.gy(Q,DS,{isEnqueuedForExpiredStreamUrlRefetch:!0}),y.api.Rb("qrd",{v:q.length}),p.return(GC(y,q,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q))):p.return([])})},v2n=function(y,q,Q){this.K=y;
this.KK=q;this.N=Q},VcC=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N;
return g.M(function(l){switch(l.K){case 1:return Q=wE(q),p=g.QX(q.entityKey),v=p.entityId,d=[],g.EC(l,2),g.R(l,d$S(y,v),4);case 4:d=l.W;if(!(y.KK.L("woffle_enable_main_downloads_library")&&((T=d)==null?0:T.length))){l.ej(5);break}return g.R(l,wHn(y.K,[q.entityKey]),5);case 5:g.Hp(l,3);break;case 2:return O=g.Rj(l),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.$C&&O.type==="QUOTA_EXCEEDED"?(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):pT("Playlist add error"),l.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,w,J));case 3:F=[];if(!y.KK.L("html5_offline_prevent_redownload_downloaded_video")){l.ej(7);break}return g.R(l,PWC(y.K,"mainVideoEntity",d),8);case 8:d=l.W;case 7:if((Y=d)==null?0:Y.length)for(f=g.t(d),h=f.next();!h.done;h=f.next())if(b=h.value,Z=b.offlineVideoData,k=void 0,(k=Z)==null?0:k.videoId)S=void 0,N=Number(((S=q.actionMetadata)==null?void 0:S.priority)||
0)+1,F.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"mainVideoEntity",N,PR,TX_(q,Z,v)));return l.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,F))}})},wAw=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM,DC,on,Oo,H,lo,Nw,Qi,Sm,E,j3,HK,mn,gk,Gf,jm,vQ,An,L,W,a,z,B,wg,e,C,D,N9,Kh,Vi,Ou,oj,LS,qd,an,ce,S3,tY,sC,uG,He;
return g.M(function(wO){switch(wO.K){case 1:return Q=wE(q),p=q.entityKey,v=g.QX(p).entityId,d=[],T=!1,v==="!*$_ALL_ENTITIES_!*$"?(T=!0,g.R(wO,Ce(y.K,"mainPlaylistEntity"),5)):g.R(wO,mp(y.K,p,"mainPlaylistEntity"),4);case 4:(O=wO.W)&&d.push(O);wO.ej(3);break;case 5:d=wO.W;case 3:if((w=d)==null||!w.length)return wO.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));J=g.U(q.actionMetadata,OEk);Y=(F=J)==null?void 0:F.nextAutoRefreshIntervalSeconds;h=(f=J)==null?void 0:f.autoSync;b=[];k=Z=
!0;S=!1;if(!T&&h===!1){wO.ej(6);break}g.EC(wO,7);return g.R(wO,kok(0,!!h,!0,d),9);case 9:b=wO.W;g.Hp(wO,8);break;case 7:N=g.Rj(wO);if(!(N instanceof Error&&N.message==="No data")){N instanceof Error&&N.message==="Empty response body"&&pT(N.message);wO.ej(8);break}return v==="!*$_ALL_ENTITIES_!*$"?g.R(wO,pHk(y.K,q,y.N,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.R(wO,jpm(v,y.K,q,y.N),8);case 8:if(!b.length||!T&&b[0].playlistId!==v)return wO.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));case 6:if(T){l=[];u=g.t(b);for(c=u.next();!c.done;c=u.next())X=c.value,X.upToDate||h&&!X.shouldAutoSyncMetadata||!X.playlistId||(A={nextAutoRefreshIntervalSeconds:X.checkInSeconds,autoSync:h},l.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X.playlistId,"mainPlaylistEntity",0,PR,{mainPlaylistEntityActionMetadata:A})));return wO.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,l))}b.length&&(Tf=b[0],S=!!Tf.upToDate,h&&(Z=(OC=Tf.shouldAutoSyncMetadata)!=null?OC:!0,k=(pS=Tf.shouldAutoSyncVideos)!=
null?pS:!0,Tf.checkInSeconds&&(Y=Tf.checkInSeconds)));if(S||!Z)return wO.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));YD=[];q9=d[0];if(!q9.downloadState){aj=void 0;wO.ej(15);break}return g.R(wO,mp(y.K,q9.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:aj=wO.W;case 15:return Pp=aj,Jm=((Fc=Pp)==null?0:Fc.addedTimestampMillis)?String(Pp.addedTimestampMillis):void 0,g.EC(wO,17),g.R(wO,d$S(y,v,Jm,Y),19);case 19:YD=wO.W;g.Hp(wO,18);break;case 17:gg=g.Rj(wO);if(!(gg instanceof
Error&&gg.message==="No data for playlist")){if(gg instanceof Error&&gg.message==="Empty response body for playlist")pT(gg.message);else return M9="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",pM="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",gg instanceof g.$C&&gg.type==="QUOTA_EXCEEDED"&&(M9="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",pM="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),wO.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,M9,pM));
wO.ej(18);break}return g.R(wO,jpm(v,y.K,q,y.N),18);case 18:if(!k)return wO.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));DC=[];on=new Map;if((Oo=YD)==null?0:Oo.length)for(H=g.t(YD),lo=H.next();!lo.done;lo=H.next())Nw=lo.value,Qi=Nw.offlineVideoData,Sm=void 0,((Sm=Qi)==null?0:Sm.videoId)&&on.set(Qi.videoId,Qi);E=new Map;j3=[];if((HK=q9)==null?0:(mn=HK.videos)==null?0:mn.length)for(gk=g.t(q9.videos),Gf=gk.next();!Gf.done;Gf=gk.next())if(jm=Gf.value,vQ=JSON.parse(g.QX(jm).entityId),
An=vQ.videoId)on.has(An)?(E.set(An,on.get(An)),on.delete(An)):j3.push(An);W=Number(((L=q.actionMetadata)==null?void 0:L.priority)||0)+1;a=g.t(on.entries());for(z=a.next();!z.done;z=a.next())B=z.value,wg=g.t(B),e=wg.next().value,C=wg.next().value,D=e,N9=C,DC.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D,"mainVideoEntity",W,PR,TX_(q,N9,v)));Kh=g.t(E.entries());for(Vi=Kh.next();!Vi.done;Vi=Kh.next())Ou=Vi.value,oj=g.t(Ou),LS=oj.next().value,qd=oj.next().value,an=LS,ce=qd,DC.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
an,"mainVideoEntity",W,PR,TX_(q,ce,v)));S3=g.t(j3);for(tY=S3.next();!tY.done;tY=S3.next())sC=tY.value,uG={playlistId:v},He={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:uG},DC.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",sC,"mainVideoEntity",0,PR,He));return wO.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,DC))}})},Jt_=function(y,q){var Q,p,v,d;
return g.M(function(T){switch(T.K){case 1:return Q=wE(q),g.EC(T,2),p=g.QX(q.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.R(T,pHk(y.K,q,y.N,(v=q.actionMetadata)==null?void 0:(d=v.offlineLoggingData)==null?void 0:d.offlineDeleteReason),5):g.R(T,jpm(p,y.K,q,y.N),6);case 6:if(!y.KK.L("woffle_enable_main_downloads_library")){T.ej(5);break}return g.R(T,JAu(y.K,q.entityKey),5);case 5:g.Hp(T,3);break;case 2:return g.Rj(T),T.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},d$S=function(y,q,Q,p){var v,d,T,O,w,J,F;
return g.M(function(Y){switch(Y.K){case 1:return g.R(Y,tx_([q]),2);case 2:return v=Y.W,g.R(Y,FJu(y,v[0],Q,p),3);case 3:return d=Y.W,T=d.mainPlaylistEntity,O=d.L53,J=yAC(T,(w=O)==null?void 0:w.avatar),g.EC(Y,4),g.R(Y,tu(J),6);case 6:g.Hp(Y,5);break;case 4:F=g.Rj(Y),F instanceof Error&&F.message==="Failed to fetch"&&pT(F.message);case 5:return Y.return(v[0].videos)}})},FJu=function(y,q,Q,p){var v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u;
return g.M(function(c){switch(c.K){case 1:v=Date.now().toString();Q||(Q=v);d=q.videos;T=q.playlistId;O=[];w=[];if(d)for(J=g.t(d),F=J.next();!F.done;F=J.next()){Y=F.value;f=Y.offlineVideoData;if(!f||!f.videoId)throw pT("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");h=f.videoId;b={videoId:h,playlistId:T};Z={id:g.po(JSON.stringify(b),"mainPlaylistVideoEntity"),video:g.po(h,"mainVideoEntity")};O.push(Z);w.push(Z.id)}S={key:g.po(T,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Q,lastSyncedTimestampMillis:v};N={key:g.po(T,"mainPlaylistEntity"),playlistId:T,videos:w,title:q.title,thumbnailStyleData:Yem(q),visibility:f9m(q),downloadState:S.key};q.channel&&(l=q.channel.offlineChannelData,k=hpS(g.po(T,"ytMainChannelEntity"),l),N.channelOwner=k.id);((u=N)==null?0:u.entityMetadata)?(N.entityMetadata.offlineLastModifiedTimestampSeconds=q.lastModifiedTimestamp,p&&(N.entityMetadata.nextAutoRefreshIntervalSeconds=String(p))):N&&(N.entityMetadata={nextAutoRefreshIntervalSeconds:p?
String(p):void 0,offlineLastModifiedTimestampSeconds:q.lastModifiedTimestamp});g.EC(c,2);return g.R(c,ii(y.K,{mode:"readwrite",ij:!0},function(X){var A=eq(X,N,"mainPlaylistEntity"),Tf=eq(X,S,"mainPlaylistDownloadStateEntity");A=[A,Tf];Tf=g.t(O);for(var OC=Tf.next();!OC.done;OC=Tf.next())A.push(eq(X,OC.value,"mainPlaylistVideoEntity"));k&&A.push(eq(X,k,"ytMainChannelEntity"));return g.kC.all(A)}),4);
case 4:g.Hp(c,3);break;case 2:throw g.Rj(c),pT("PES failure for playlist"),Error("PES failure for playlist");case 3:return c.return({mainPlaylistEntity:N,L53:k,hqV:O})}})},hpS=function(y,q){return{id:y,
channelId:q.channelId,title:q.title,avatar:q.thumbnail}},Yem=function(y){var q=[],Q=y.videos;
Q&&Q.length>0&&q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Q[0].offlineVideoData.thumbnail}}});if((y=y.additionalMetadadatas)&&y.length>0)for(y=g.t(y),Q=y.next();!Q.done;Q=y.next()){var p=Q.value.offlineBundleItemPlaylistData,v=void 0;Q=(v=p)==null?void 0:v.style;v=void 0;p={collageThumbnail:{coverThumbnail:(v=p)==null?void 0:v.coverThumbnail}};switch(Q){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:p});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:p});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:p});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:p})}}return q},f9m=function(y){switch(y.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},TX_=function(y,q,Q){q={offlineVideoData:q,
playlistId:Q};if(y=g.U(y.actionMetadata,OEk))q.maximumDownloadQuality=y.maximumDownloadQuality;return{mainVideoEntityActionMetadata:q}},bEC=function(y,q,Q){this.K=y;
this.KK=q;this.N=Q},x$e=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b;
return g.M(function(Z){switch(Z.K){case 1:return Q=wE(q),p=g.QX(q.entityKey),v=p.entityId,d=g.U(q.actionMetadata,iY),O=!((T=d)==null?0:T.playlistId),g.EC(Z,2),g.R(Z,$$q(y,v,void 0,(w=d)==null?void 0:w.offlineVideoData,O),4);case 4:g.Hp(Z,3);break;case 2:return J=g.Rj(Z),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.$C&&J.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Z.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,F,Y));case 3:f=1;f=Number(((h=q.actionMetadata)==null?void 0:h.priority)||0)+1;var k=(k=g.U(q.actionMetadata,iY))?{playbackDataActionMetadata:{maximumDownloadQuality:k.maximumDownloadQuality}}:void 0;b=lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v,"playbackData",f,KJG,k);return Z.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,[b]))}})},WJS=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N;
return g.M(function(l){switch(l.K){case 1:return Q=wE(q),p=g.QX(q.entityKey),v=p.entityId,g.R(l,mp(y.K,q.entityKey,"mainVideoEntity"),2);case 2:d=l.W;if(!d){T=void 0;l.ej(3);break}return g.R(l,mp(y.K,d.downloadState,"mainVideoDownloadStateEntity"),4);case 4:T=l.W;case 3:O=T;if(!d||!O)return l.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));g.EC(l,5);return g.R(l,$$q(y,v,O.addedTimestampMillis,(J=g.U(q.actionMetadata,iY))==null?void 0:J.offlineVideoData),7);case 7:F=1;F=Number(((Y=
q.actionMetadata)==null?void 0:Y.priority)||0)+1;w=lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v,"playbackData",F,KJG);g.Hp(l,6);break;case 5:f=g.Rj(l);if(!(f instanceof Error&&f.message==="No data")){if(f instanceof Error&&f.message==="Empty response body")pT(f.message);else return h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.$C&&f.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,h,b));l.ej(6);break}return g.R(l,LT(y.K,v),9);case 9:Z=l.W;k=g.U(q.actionMetadata,iY);if(N=(S=k)==null?void 0:S.playlistId)Z.playlistId=N;Z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.R(l,EF(v,y.K,q,y.N,Z),6);case 6:return l.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,w?[w]:void 0))}})},ZEC=function(y,q){var Q,p,v,d,T,O,w,J,F,Y;
return g.M(function(f){switch(f.K){case 1:return Q=wE(q),g.EC(f,2),p=g.QX(q.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.R(f,pHk(y.K,q,y.N,(F=q.actionMetadata)==null?void 0:(Y=F.offlineLoggingData)==null?void 0:Y.offlineDeleteReason),5):g.R(f,LT(y.K,p),6);case 6:v=f.W;d=g.U(q.actionMetadata,iY);if(O=(T=d)==null?void 0:T.playlistId)v.playlistId=O;v.offlineDeleteReason=(w=q.actionMetadata)==null?void 0:(J=w.offlineLoggingData)==null?void 0:J.offlineDeleteReason;return g.R(f,EF(p,y.K,q,y.N,v),7);
case 7:if(!y.KK.L("woffle_enable_main_downloads_library")){f.ej(5);break}return g.R(f,JAu(y.K,q.entityKey),5);case 5:g.Hp(f,3);break;case 2:return g.Rj(f),f.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q))}})},$$q=function(y,q,Q,p,v){var d,T,O,w,J,F;
return g.M(function(Y){switch(Y.K){case 1:if(d=p){Y.ej(2);break}return g.R(Y,ZXc([q]),3);case 3:T=Y.W,d=T[0];case 2:return g.R(Y,tcm(y,d,Q,v),4);case 4:O=Y.W;w=O.mainVideoEntity;J=O.channelEntity;g.EC(Y,5);var f=$L(w.thumbnail),h=$L(J.avatar);return g.R(Y,tu(f.concat(h)),7);case 7:g.Hp(Y,0);break;case 5:F=g.Rj(Y),F instanceof Error&&F.message==="Failed to fetch"&&pT(F.message),g.tH(Y)}})},tcm=function(y,q,Q,p){var v,d,T,O,w,J,F,Y,f,h,b,Z,k;
return g.M(function(S){switch(S.K){case 1:Q||(Q=Date.now().toString());d=(v=q.channel)==null?void 0:v.offlineChannelData;T={id:g.po(q.videoId,"ytMainChannelEntity"),channelId:d.channelId,title:d.title,avatar:d.thumbnail};O={key:g.po(q.videoId,"mainVideoDownloadStateEntity"),playbackData:g.po(q.videoId,"playbackData"),addedTimestampMillis:Q,videoDownloadContextEntity:g.po(q.videoId,"videoDownloadContextEntity")};w={key:g.po(q.videoId,"videoPlaybackPositionEntity"),videoId:q.videoId,lastPlaybackPositionSeconds:"0"};
y.KK.L("html5_offline_playback_position_sync")&&(J={playbackPosition:w.key});F=g.po(q.videoId,"mainVideoEntity");Y={key:F,videoId:q.videoId,title:q.title,thumbnail:q.thumbnail,localizedStrings:{viewCount:q.shortViewCountText},userState:J,lengthSeconds:q.lengthSeconds?Number(q.lengthSeconds):void 0,publishedTimestampMillis:q.publishedTimestamp?(Number(q.publishedTimestamp)*1E3).toString():void 0,formattedDescription:q.description,owner:T.id,downloadState:O.key};if(!y.KK.L("woffle_enable_main_downloads_library")||
!p){S.ej(2);break}return g.R(S,OXq(y.K,[F]),3);case 3:if(b=S.W)f=b.mainDownloadsLibraryEntity,h=b.mainDownloadsListEntity;case 2:return k=GQX,Z={key:g.po(q.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.gy(O,k,Z),g.R(S,ii(y.K,{mode:"readwrite",ij:!0},function(N){var l=eq(N,T,"ytMainChannelEntity"),u=eq(N,O,"mainVideoDownloadStateEntity"),c=eq(N,Y,"mainVideoEntity");l=[l,u,c];y.KK.L("html5_offline_playback_position_sync")&&(u=eq(N,w,"videoPlaybackPositionEntity"),
l.push(u));f&&(u=eq(N,f,"mainDownloadsLibraryEntity"),l.push(u));h&&(u=eq(N,h,"mainDownloadsListEntity"),l.push(u));Z&&(N=eq(N,Z,"downloadStatusEntity"),l.push(N));return g.kC.all(l)}),4);
case 4:return S.return({mainVideoEntity:Y,channelEntity:T})}})},E2m=function(y,q,Q){this.K=y;
this.KK=q;this.N=Q},LJ_=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9;
return g.M(function(aj){switch(aj.K){case 1:return Q=wE(q),p=[],g.R(aj,g8.getInstance(),2);case 2:v=aj.W;if(!v){aj.ej(3);break}return g.R(aj,v.get("sdois"),4);case 4:return d=aj.W,g.R(aj,(O=v)==null?void 0:O.get("lmqf"),5);case 5:T=aj.W;case 3:g.EC(aj,6);if(d===void 0)throw Error("prefStorage or opt-in state is undefined");w=[];if(d){aj.ej(8);break}return g.R(aj,VxX(y.K),9);case 9:w=aj.W,w.reverse();case 8:if(!w.length){aj.ej(10);break}J=g.t(w);F=J.next();case 11:if(F.done){aj.ej(10);break}Y=F.value;
if(!Y){aj.ej(12);break}f=g.QX(Y).entityId;return g.R(aj,LT(y.K,f),14);case 14:return h=aj.W,h.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.R(aj,EF(f,y.K,{entityKey:Y,actionType:q.actionType},y.N,h),12);case 12:F=J.next();aj.ej(11);break;case 10:return g.R(aj,aec(d,(b=T)!=null?b:"SD"),16);case 16:return Z=aj.W,g.R(aj,v0C(Z),17);case 17:k=TPm(Z);if(!y.KK.L("woffle_enable_main_downloads_library")){aj.ej(18);break}if(d){aj.ej(19);break}return g.R(aj,JAu(y.K,g.uT),19);case 19:return g.R(aj,
wHn(y.K,[g.uT]),18);case 18:if((S=k)==null?0:S.length)for(N=g.t(k),l=N.next();!l.done;l=N.next())if(c=u=l.value,X=c.actionType,A=c.entityKey,Tf=c.actionMetadata,X&&A&&Tf&&!g.U(Tf,kcc)){X==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Tf.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(OC=g.U(u.actionMetadata,iY))OC.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",u.actionMetadata=Object.assign({},u.actionMetadata,{mainVideoEntityActionMetadata:OC});p.push(u)}g.Hp(aj,
7);break;case 6:return pS=g.Rj(aj),YD="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q9="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",pS instanceof g.$C&&pS.type==="QUOTA_EXCEEDED"&&(YD="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q9="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),aj.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,YD,q9));case 7:return aj.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,p))}})},a9k=function(){BR.apply(this,
arguments);
this.j="mainVideoEntity"},NXc=function(y,q,Q){q=q===void 0?43200:q;
Q=Q===void 0?!0:Q;var p=p===void 0?!1:p;var v,d,T;return g.M(function(O){switch(O.K){case 1:if(!y.G.rh())return O.return([]);v=[];g.EC(O,2);return g.R(O,kok(q,Q,p),4);case 4:v=O.W;g.Hp(O,3);break;case 2:d=g.Rj(O),d instanceof Error&&d.message==="No data"||d instanceof Error&&d.message==="Empty response body"&&pT(d.message);case 3:return T=Q3C(y,v,Q,"mainPlaylistEntity"),O.return(T)}})},SeC=function(y,q,Q,p){p=p===void 0?!1:p;
var v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N;return g.M(function(l){switch(l.K){case 1:return v=[],g.R(l,LuC(),2);case 2:return(d=l.W)||p?g.R(l,NPq(q,Q),3):l.return([]);case 3:T=l.W;if((O=T)==null||!O.length)return l.return([]);w={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};J=g.t(T);F=J.next();case 4:if(F.done){l.ej(6);break}f=Y=F.value;h=f.actionType;b=f.entityKey;Z=f.actionMetadata;if(!(h&&b&&Z)||g.U(Z,kcc)){l.ej(5);break}h==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Z.offlineLoggingData=
w);k=g.QX(b);S=k.entityId;return g.R(l,GC(y,[S],"mainVideoEntity",h,Z),8);case 8:N=l.W,v=v.concat(N);case 5:F=J.next();l.ej(4);break;case 6:return l.return(v)}})},HE_=function(y,q){this.K=y;
this.N=q},s3h=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S;
return g.M(function(N){switch(N.K){case 1:return Q=wE(q),p=g.QX(q.entityKey),v=p.entityId,d=[],g.EC(N,2),g.R(N,Rpm(y,v),4);case 4:d=N.W;if((T=d)==null||!T.length){N.ej(5);break}return g.R(N,bXh(y.K,q.entityKey),5);case 5:g.Hp(N,3);break;case 2:return O=g.Rj(N),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.$C&&O.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
N.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,w,J));case 3:return F=[],g.R(N,PWC(y.K,"musicTrack",d),7);case 7:d=N.W;if(d.length)for(Y=g.t(d),f=Y.next();!f.done;f=Y.next())if(h=f.value,b=h.offlineVideoData,Z=void 0,(Z=b)==null?0:Z.videoId)k=void 0,S=Number(((k=q.actionMetadata)==null?void 0:k.priority)||0)+1,F.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b.videoId,"musicTrack",S,XS,HR(q,b,v)));return N.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,F))}})},
Mcn=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM,DC,on,Oo,H,lo,Nw,Qi,Sm,E,j3,HK,mn,gk,Gf,jm,vQ,An,L,W,a,z,B,wg,e,C;
return g.M(function(D){switch(D.K){case 1:return Q=wE(q),p=q.entityKey,v=g.QX(p).entityId,d=[],T=!1,v==="!*$_ALL_ENTITIES_!*$"?(T=!0,g.R(D,Ce(y.K,"musicAlbumRelease"),5)):g.R(D,mp(y.K,p,"musicAlbumRelease"),4);case 4:(O=D.W)&&d.push(O);D.ej(3);break;case 5:d=D.W;case 3:if((w=d)==null||!w.length)return D.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));if(T){J=[];F=g.t(d);for(Y=F.next();!Y.done;Y=F.next())f=Y.value,h=g.QX(f.id).entityId,J.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
h,"musicAlbumRelease",0,XS));return D.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,J))}b=[];Z=d[0];k=void 0;if(!Z.downloadMetadata){D.ej(6);break}return g.R(D,mp(y.K,Z.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:S=D.W,k=Number((l=(N=S)==null?void 0:N.addedTimestampMillis)!=null?l:"0")/1E3;case 6:return g.EC(D,8),g.R(D,Rpm(y,v,(u=k)==null?void 0:u.toString()),10);case 10:b=D.W;g.Hp(D,9);break;case 8:c=g.Rj(D);if(!(c instanceof Error&&c.message==="No data")){if(c instanceof
Error&&c.message==="Empty response body")pT(c.message);else return X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.$C&&c.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),D.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,X,A));D.ej(9);break}return g.R(D,Nh(v,"musicAlbumRelease",y.K,q,y.N),9);case 9:Tf=[];OC=new Map;
if((pS=b)==null?0:pS.length)for(YD=g.t(b),q9=YD.next();!q9.done;q9=YD.next())aj=q9.value,Pp=aj.offlineVideoData,Fc=void 0,((Fc=Pp)==null?0:Fc.videoId)&&OC.set(Pp.videoId,Pp);Jm=new Map;gg=[];if((M9=Z)==null?0:(pM=M9.tracks)==null?0:pM.length)for(DC=g.t(Z.tracks),on=DC.next();!on.done;on=DC.next())if(Oo=on.value,H=g.QX(Oo).entityId)OC.has(H)?(Jm.set(H,OC.get(H)),OC.delete(H)):gg.push(H);Nw=Number(((lo=q.actionMetadata)==null?void 0:lo.priority)||0)+1;Qi=g.t(OC.entries());for(Sm=Qi.next();!Sm.done;Sm=
Qi.next())E=Sm.value,j3=g.t(E),HK=j3.next().value,mn=j3.next().value,gk=HK,Gf=mn,Tf.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",gk,"musicTrack",Nw,XS,HR(q,Gf)));jm=g.t(Jm.entries());for(vQ=jm.next();!vQ.done;vQ=jm.next())An=vQ.value,L=g.t(An),W=L.next().value,a=L.next().value,z=W,B=a,Tf.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",z,"musicTrack",Nw,XS,HR(q,B)));wg=g.t(gg);for(e=wg.next();!e.done;e=wg.next())C=e.value,Tf.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",C,"musicTrack",
0,XS));return D.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,Tf))}})},l9w=function(y,q){var Q,p;
return g.M(function(v){switch(v.K){case 1:return Q=wE(q),g.EC(v,2),p=g.QX(q.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.R(v,SN(y.K,q,y.N),5):g.R(v,Nh(p,"musicAlbumRelease",y.K,q,y.N),6);case 6:return g.R(v,$nX(y.K,q.entityKey),5);case 5:g.Hp(v,3);break;case 2:return g.Rj(v),v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},Rpm=function(y,q,Q){var p,v,d;
return g.M(function(T){switch(T.K){case 1:return g.R(T,tx_([q]),2);case 2:return p=T.W,g.R(T,zpm(y,p[0],Q),3);case 3:return v=T.W,d=$L(v.thumbnailDetails),g.R(T,tu(d),4);case 4:return T.return(p[0].videos)}})},zpm=function(y,q,Q){var p,v,d,T,O,w,J,F,Y,f,h,b,Z,k;
return g.M(function(S){if(S.K==1){p=q.additionalMetadadatas;v=void 0;if(p&&p.length>0)for(d=g.t(p),T=d.next();!T.done;T=d.next())if(O=T.value,O.offlineMusicPlaylistData){v=O.offlineMusicPlaylistData;break}w=q.playlistId;J=Ku_(q);F=J.eq;Y=J.Sq;f=Q?(Number(Q)*1E3).toString():Date.now().toString();h=q.lastModifiedTimestamp?(Number(q.lastModifiedTimestamp)*1E3).toString():"0";b={id:g.po(w,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:Y,lastModifiedTimestampMillis:h,addedTimestampMillis:f,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Z={id:g.po(w,"musicAlbumRelease"),title:q.title,audioPlaylistId:w,trackCount:q.totalVideoCount,tracks:F,downloadMetadata:b.id};v&&(Z.thumbnailDetails=(k=v.albumHqThumbnail)!=null?k:v.albumArtistThumbnail,Z.artistDisplayName=v.albumArtistDisplayName,Z.releaseDate=v.albumReleaseDate,Z.contentRating={explicitType:v.albumReleaseExplicitType},Z.releaseType=v.albumReleaseType);return g.R(S,ii(y.K,{mode:"readwrite",ij:!0},function(N){var l=eq(N,Z,"musicAlbumRelease");
N=eq(N,b,"musicAlbumReleaseDownloadMetadataEntity");return g.kC.all([l,N])}),2)}return S.return(Z)})},D$k=function(y,q){this.K=y;
this.N=q},I9q=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S;
return g.M(function(N){switch(N.K){case 1:return Q=wE(q),p=g.QX(q.entityKey),v=p.entityId,d=[],g.EC(N,2),g.R(N,uYG(y,v),4);case 4:d=N.W;if((T=d)==null||!T.length){N.ej(5);break}return g.R(N,bXh(y.K,q.entityKey),5);case 5:g.Hp(N,3);break;case 2:return O=g.Rj(N),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.$C&&O.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
N.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,w,J));case 3:return F=[],g.R(N,PWC(y.K,"musicTrack",d),7);case 7:d=N.W;if(d.length)for(Y=g.t(d),f=Y.next();!f.done;f=Y.next())if(h=f.value,b=h.offlineVideoData,Z=void 0,(Z=b)==null?0:Z.videoId)k=void 0,S=Number(((k=q.actionMetadata)==null?void 0:k.priority)||0)+1,F.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b.videoId,"musicTrack",S,mB,HR(q,b,v)));return N.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,F))}})},
n2u=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM,DC,on,Oo,H,lo,Nw,Qi,Sm,E,j3,HK,mn,gk,Gf,jm,vQ,An,L,W,a,z,B,wg,e,C,D,N9,Kh,Vi,Ou,oj,LS,qd,an,ce,S3,tY;
return g.M(function(sC){switch(sC.K){case 1:return Q=wE(q),p=q.entityKey,v=g.QX(p).entityId,d=[],T=!1,v==="!*$_ALL_ENTITIES_!*$"?(T=!0,g.R(sC,Ce(y.K,"musicPlaylist"),5)):g.R(sC,mp(y.K,p,"musicPlaylist"),4);case 4:(O=sC.W)&&d.push(O);sC.ej(3);break;case 5:d=sC.W;case 3:if((w=d)==null||!w.length)return sC.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));J=g.U(q.actionMetadata,xn_);Y=(F=J)==null?void 0:F.autoSync;f=[];b=h=!0;Z=!1;k=void 0;if(!T&&Y===!1){sC.ej(6);break}g.EC(sC,7);return g.R(sC,
Sa_(0,!!Y,!0,d),9);case 9:f=sC.W;g.Hp(sC,8);break;case 7:S=g.Rj(sC);if(!(S instanceof Error&&S.message==="No data")){S instanceof Error&&S.message==="Empty response body"&&pT(S.message);sC.ej(8);break}return v==="!*$_ALL_ENTITIES_!*$"?g.R(sC,SN(y.K,q,y.N),8):g.R(sC,Nh(v,"musicPlaylist",y.K,q,y.N),8);case 8:if(!f.length||!T&&f[0].playlistId!==v)return sC.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));case 6:if(T){N=[];l=g.t(f);for(u=l.next();!u.done;u=l.next())c=u.value,c.upToDate||
Y&&!c.shouldAutoSyncMetadata||!c.playlistId||(X={autoSync:Y},N.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c.playlistId,"musicPlaylist",0,mB,{musicPlaylistEntityActionMetadata:X})));return sC.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,N))}f.length&&(A=f[0],Z=!!A.upToDate,Y&&(h=(Tf=A.shouldAutoSyncMetadata)!=null?Tf:!0,b=(OC=A.shouldAutoSyncVideos)!=null?OC:!0,A.checkInSeconds&&(k=A.checkInSeconds)));if(Z||!h)return sC.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));pS=[];YD=d[0];q9=void 0;if(!YD.downloadMetadata){sC.ej(15);break}return g.R(sC,mp(y.K,YD.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:aj=sC.W,q9=Number((Fc=(Pp=aj)==null?void 0:Pp.addedTimestampMillis)!=null?Fc:"0")/1E3;case 15:return g.EC(sC,17),g.R(sC,uYG(y,v,(Jm=q9)==null?void 0:Jm.toString(),k),19);case 19:pS=sC.W;g.Hp(sC,18);break;case 17:gg=g.Rj(sC);if(!(gg instanceof Error&&gg.message==="No data")){if(gg instanceof Error&&gg.message==="Empty response body")pT(gg.message);
else return M9="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",pM="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",gg instanceof g.$C&&gg.type==="QUOTA_EXCEEDED"&&(M9="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",pM="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sC.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,M9,pM));sC.ej(18);break}return g.R(sC,Nh(v,"musicPlaylist",y.K,q,y.N),18);case 18:if(!b)return sC.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q));DC=[];on=new Map;if((Oo=pS)==null?0:Oo.length)for(H=g.t(pS),lo=H.next();!lo.done;lo=H.next())Nw=lo.value,Qi=Nw.offlineVideoData,Sm=void 0,((Sm=Qi)==null?0:Sm.videoId)&&on.set(Qi.videoId,Qi);E=new Map;j3=[];if((HK=YD)==null?0:(mn=HK.tracks)==null?0:mn.length)for(gk=g.t(YD.tracks),Gf=gk.next();!Gf.done;Gf=gk.next())if(jm=Gf.value,vQ=g.QX(jm).entityId)on.has(vQ)?(E.set(vQ,on.get(vQ)),on.delete(vQ)):j3.push(vQ);L=Number(((An=q.actionMetadata)==null?void 0:An.priority)||0)+1;W=g.t(on.entries());for(a=
W.next();!a.done;a=W.next())z=a.value,B=g.t(z),wg=B.next().value,e=B.next().value,C=wg,D=e,DC.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C,"musicTrack",L,mB,HR(q,D)));N9=g.t(E.entries());for(Kh=N9.next();!Kh.done;Kh=N9.next())Vi=Kh.value,Ou=g.t(Vi),oj=Ou.next().value,LS=Ou.next().value,qd=oj,an=LS,DC.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",qd,"musicTrack",L,mB,HR(q,an)));ce=g.t(j3);for(S3=ce.next();!S3.done;S3=ce.next())tY=S3.value,DC.push(lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
tY,"musicTrack",0,mB));return sC.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,DC))}})},g2_=function(y,q){var Q,p;
return g.M(function(v){switch(v.K){case 1:return Q=wE(q),g.EC(v,2),p=g.QX(q.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.R(v,SN(y.K,q,y.N),5):g.R(v,Nh(p,"musicPlaylist",y.K,q,y.N),6);case 6:return g.R(v,$nX(y.K,q.entityKey),5);case 5:g.Hp(v,3);break;case 2:return g.Rj(v),v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},uYG=function(y,q,Q,p){var v,d,T;
return g.M(function(O){switch(O.K){case 1:return g.R(O,tx_([q]),2);case 2:return v=O.W,g.R(O,cte(y,v[0],Q,p),3);case 3:return d=O.W,T=$L(d.thumbnailDetails),g.R(O,tu(T),4);case 4:return O.return(v[0].videos)}})},cte=function(y,q,Q,p){var v,d,T,O,w,J,F,Y,f;
return g.M(function(h){return h.K==1?(v=q.playlistId,d=Ku_(q),T=d.eq,O=d.Sq,w=Q?(Number(Q)*1E3).toString():Date.now().toString(),J=q.lastModifiedTimestamp?(Number(q.lastModifiedTimestamp)*1E3).toString():"0",F={id:g.po(v,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:O,lastModifiedTimestampMillis:J,addedTimestampMillis:w,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},Y={id:g.po(v,"musicPlaylist"),title:q.title,playlistId:v,thumbnailDetails:q.thumbnail,visibility:U$m(q),trackCount:q.totalVideoCount,
tracks:T,downloadMetadata:F.id},p&&(((f=Y)==null?0:f.entityMetadata)?Y.entityMetadata.nextAutoRefreshIntervalSeconds=String(p):Y&&(Y.entityMetadata={nextAutoRefreshIntervalSeconds:String(p)})),g.R(h,ii(y.K,{mode:"readwrite",ij:!0},function(b){var Z=eq(b,Y,"musicPlaylist");b=eq(b,F,"musicPlaylistDownloadMetadataEntity");return g.kC.all([Z,b])}),2)):h.return(Y)})},U$m=function(y){switch(y.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},rtm=function(y,q){this.K=y;
this.N=q},BXh=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b;
return g.M(function(Z){switch(Z.K){case 1:return Q=wE(q),p=g.QX(q.entityKey),v=p.entityId,d=g.U(q.actionMetadata,o2_),g.EC(Z,2),g.R(Z,At_(y,v,void 0,(T=d)==null?void 0:T.track,(O=d)==null?void 0:O.albumRelease),4);case 4:if((w=d)==null?0:w.playlistId){Z.ej(5);break}return g.R(Z,bXh(y.K,q.entityKey),5);case 5:g.Hp(Z,3);break;case 2:return J=g.Rj(Z),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.$C&&J.type==="QUOTA_EXCEEDED"&&
(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,F,Y));case 3:h=Number(((f=q.actionMetadata)==null?void 0:f.priority)||0)+1;var k=(k=g.U(q.actionMetadata,o2_))?{playbackDataActionMetadata:{maximumDownloadQuality:k.maximumDownloadQuality}}:void 0;b=lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v,"playbackData",h,epe,k);return Z.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q,[b]))}})},Gcn=function(y,q){var Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k;
return g.M(function(S){switch(S.K){case 1:return Q=wE(q),p=g.QX(q.entityKey),v=p.entityId,g.R(S,mp(y.K,q.entityKey,"musicTrack"),2);case 2:d=S.W;if(!d){T=void 0;S.ej(3);break}return g.R(S,mp(y.K,d.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:T=S.W;case 3:O=T;if(!d||!O)return S.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q));J=g.U(q.actionMetadata,o2_);g.EC(S,5);return g.R(S,At_(y,v,O.addedTimestampMillis,(F=J)==null?void 0:F.track,(Y=J)==null?void 0:Y.albumRelease),
7);case 7:h=Number(((f=q.actionMetadata)==null?void 0:f.priority)||0)+1;w=lY("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v,"playbackData",h,epe);g.Hp(S,6);break;case 5:b=g.Rj(S);if(!(b instanceof Error&&b.message==="No data")){if(b instanceof Error&&b.message==="Empty response body")pT(b.message);else return Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.$C&&b.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,Z,k));S.ej(6);break}return g.R(S,av(v,y.K,q,y.N),6);case 6:return S.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Q,w?[w]:void 0))}})},PpC=function(y,q){var Q,p;
return g.M(function(v){switch(v.K){case 1:return Q=wE(q),g.EC(v,2),p=g.QX(q.entityKey).entityId,p==="!*$_ALL_ENTITIES_!*$"?g.R(v,SN(y.K,q,y.N),5):g.R(v,av(p,y.K,q,y.N),6);case 6:return g.R(v,$nX(y.K,q.entityKey),5);case 5:g.Hp(v,3);break;case 2:return g.Rj(v),v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new zC("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Q))}})},At_=function(y,q,Q,p,v){var d,T,O,w,J,F;
return g.M(function(Y){switch(Y.K){case 1:if(d=p){Y.ej(2);break}return g.R(Y,ZXc([q]),3);case 3:T=Y.W,O=T[0],d=hen(O);case 2:return g.R(Y,iEn(y,d,q,v,Q),4);case 4:w=Y.W;J=w.musicTrackEntity;F=w.tp;var f=$L(J.thumbnailDetails),h=[];F&&(h=$L(F.thumbnailDetails));return g.R(Y,tu(f.concat(h)),0)}})},iEn=function(y,q,Q,p,v){var d;
return g.M(function(T){return T.K==1?(v||(v=Date.now().toString()),d={id:g.po(Q,"musicTrackDownloadMetadataEntity"),playbackData:g.po(Q,"playbackData"),addedTimestampMillis:v,videoDownloadContextEntity:g.po(Q,"videoDownloadContextEntity")},p&&(q.albumRelease=p.id),g.R(T,ii(y.K,{mode:"readwrite",ij:!0},function(O){var w=[],J=eq(O,d,"musicTrackDownloadMetadataEntity");w.push(J);J=eq(O,q,"musicTrack");w.push(J);p&&(O=eq(O,p,"musicAlbumRelease"),w.push(O));return g.kC.all(w)}),2)):T.K!=3?g.R(T,fT(Q,"musicTrackDownloadMetadataEntity",
y.K,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):T.return({musicTrackEntity:q,
tp:p})})},CT=function(){BR.apply(this,arguments);
this.j="musicTrack"},XA_=function(y,q,Q){q=q===void 0?43200:q;
Q=Q===void 0?!0:Q;var p=p===void 0?!1:p;var v,d;return g.M(function(T){switch(T.K){case 1:if(!y.G.rh())return T.return([]);v=[];g.EC(T,2);return g.R(T,Sa_(q,Q,p),4);case 4:v=T.W;g.Hp(T,3);break;case 2:g.Rj(T);case 3:return d=Q3C(y,v,Q,"musicPlaylist"),T.return(d)}})},m$S=function(){g.LC.apply(this,arguments);
var y=this;this.events=new g.sU(this);this.KK=this.player.T();this.je={Jlb:function(){return y.K},
LA:function(){return y.LA()},
wf:function(q){return y.wf(q)}}},Cp_=function(y){var q;
y=g.U((q=y.getWatchNextResponse())==null?void 0:q.currentVideoEndpoint,g.H3);if(y==null?0:y.playlistId)var Q=y.playlistId;return Q},yMS=function(y,q){var Q,p,v,d;
return g.M(function(T){if(T.K==1){Q=q.clientPlaybackNonce;p={cpn:Q,offlineSourceVisualElement:g.t4(q.N$||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};q.W&&(p.videoFmt=Number(q.W.itag));q.Y&&(p.audioFmt=Number(q.Y.itag));if((v=Cp_(q))&&q.videoId){var O=q.videoId;O=v!=="PPSV"?Promise.resolve(!1):y.K.Xe(O);T=g.R(T,O,3)}else T=T.ej(2);return T}T.K!=2&&(d=T.W)&&(p.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");y.W=Q;g.wU("offlinePlaybackStarted",p);g.tH(T)})};
g.ih.prototype.lW=g.vp(45,function(y){return this.app.lW(y)});
g.$5.prototype.lW=g.vp(44,function(y){return g.Tef(this,9,y)});
g.x(I7,ui);g.dg.Object.defineProperties(I7.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.K.entityMetadata},
set:function(y){this.K.entityMetadata=y}}});
g.x(rvc,I7);rvc.prototype.W=function(){return[]};
g.x(oU_,I7);oU_.prototype.W=function(){return[]};
g.x(Av_,I7);Av_.prototype.W=function(){return[]};
g.x(ebk,I7);ebk.prototype.W=function(){return[]};
g.x(Brc,I7);Brc.prototype.W=function(){return[]};
g.x(Gyh,I7);Gyh.prototype.W=function(){var y=[];this.K.alternateChannel&&y.push(this.K.alternateChannel);this.K.alternateChannelList&&y.push.apply(y,g.hH(this.K.alternateChannelList));this.K.oneofChannelEntity&&y.push(this.K.oneofChannelEntity);return[].concat(g.hH(new Set(y)))};
g.x(Pmm,I7);Pmm.prototype.W=function(){var y=[];this.K.entryCollection&&y.push(this.K.entryCollection);return[].concat(g.hH(new Set(y)))};
g.x(iYe,ui);iYe.prototype.W=function(){var y=[];this.K.video&&y.push(this.K.video);return[].concat(g.hH(new Set(y)))};
g.x(X2k,I7);X2k.prototype.W=function(){var y=[];this.K.parentPlaylist&&y.push(this.K.parentPlaylist);if(this.K.entries)for(var q=g.t(this.K.entries),Q=q.next();!Q.done;Q=q.next())y.push.apply(y,g.hH((new iYe(Q.value)).W()));return[].concat(g.hH(new Set(y)))};
g.x(mam,I7);mam.prototype.W=function(){var y=[];this.K.descriptionEntity&&y.push(this.K.descriptionEntity);this.K.creators&&y.push.apply(y,g.hH(this.K.creators));this.K.theBiggestFan&&y.push(this.K.theBiggestFan);return[].concat(g.hH(new Set(y)))};
g.x(Cmw,I7);Cmw.prototype.W=function(){return[]};
g.x(yj_,I7);yj_.prototype.W=function(){return[]};
g.x(qNe,I7);qNe.prototype.W=function(){return[]};
g.x(j_m,I7);j_m.prototype.W=function(){return[]};
g.x(Q_C,I7);Q_C.prototype.W=function(){return[]};
g.x(pP_,I7);pP_.prototype.W=function(){return[]};
g.x(vKX,I7);vKX.prototype.W=function(){return[]};
g.x(dSh,I7);dSh.prototype.W=function(){return[]};
g.x(TDC,I7);TDC.prototype.W=function(){return[]};
g.x(VPm,I7);VPm.prototype.W=function(){var y=[];this.K.downloadsList&&y.push(this.K.downloadsList);this.K.smartDownloadsList&&y.push(this.K.smartDownloadsList);this.K.recommendedDownloadsList&&y.push(this.K.recommendedDownloadsList);this.K.refresh&&y.push(this.K.refresh);return[].concat(g.hH(new Set(y)))};
g.x(ORm,ui);ORm.prototype.W=function(){var y=[];this.K.video&&y.push(this.K.video);this.K.playlist&&y.push(this.K.playlist);this.K.videoItem&&y.push(this.K.videoItem);this.K.playlistItem&&y.push(this.K.playlistItem);return[].concat(g.hH(new Set(y)))};
g.x(wPC,I7);wPC.prototype.W=function(){var y=[];this.K.refresh&&y.push(this.K.refresh);if(this.K.downloads)for(var q=g.t(this.K.downloads),Q=q.next();!Q.done;Q=q.next())y.push.apply(y,g.hH((new ORm(Q.value)).W()));return[].concat(g.hH(new Set(y)))};
g.x(Jjq,I7);Jjq.prototype.W=function(){var y=[];this.K.localImageEntities&&y.push.apply(y,g.hH(this.K.localImageEntities));return[].concat(g.hH(new Set(y)))};
g.x(Fk_,I7);Fk_.prototype.W=function(){var y=[];this.K.playbackData&&y.push(this.K.playbackData);this.K.localImageEntities&&y.push.apply(y,g.hH(this.K.localImageEntities));this.K.videoDownloadContextEntity&&y.push(this.K.videoDownloadContextEntity);return[].concat(g.hH(new Set(y)))};
g.x(YNe,I7);YNe.prototype.W=function(){return[]};
g.x(f7G,I7);f7G.prototype.W=function(){var y=[];this.K.fakeChildren&&y.push.apply(y,g.hH(this.K.fakeChildren));return[].concat(g.hH(new Set(y)))};
g.x(hhX,I7);hhX.prototype.W=function(){var y=[];this.K.video&&y.push(this.K.video);this.K.playbackData&&y.push(this.K.playbackData);this.K.offlineVideoPolicy&&y.push(this.K.offlineVideoPolicy);return[].concat(g.hH(new Set(y)))};
g.x(bRu,I7);bRu.prototype.W=function(){return[]};
g.x($Sn,I7);$Sn.prototype.W=function(){var y=[];this.K.channelOwner&&y.push(this.K.channelOwner);this.K.videos&&y.push.apply(y,g.hH(this.K.videos));this.K.collaboratorChannels&&y.push.apply(y,g.hH(this.K.collaboratorChannels));this.K.downloadState&&y.push(this.K.downloadState);this.K.refresh&&y.push(this.K.refresh);return[].concat(g.hH(new Set(y)))};
g.x(Kkm,I7);Kkm.prototype.W=function(){var y=[];this.K.video&&y.push(this.K.video);this.K.channelContributor&&y.push(this.K.channelContributor);return[].concat(g.hH(new Set(y)))};
g.x(xSm,ui);xSm.prototype.W=function(){var y=[];this.K.localImageEntities&&y.push.apply(y,g.hH(this.K.localImageEntities));this.K.videoDownloadContextEntity&&y.push(this.K.videoDownloadContextEntity);return[].concat(g.hH(new Set(y)))};
g.x(Wkh,ui);Wkh.prototype.W=function(){var y=[];this.K.recommendedVideoMetadata&&y.push.apply(y,g.hH((new xSm(this.K.recommendedVideoMetadata)).W()));return[].concat(g.hH(new Set(y)))};
g.x(ZRG,ui);ZRG.prototype.W=function(){var y=[];this.K.playbackPosition&&y.push(this.K.playbackPosition);return[].concat(g.hH(new Set(y)))};
g.x(tPm,I7);tPm.prototype.W=function(){var y=[];this.K.owner&&y.push(this.K.owner);this.K.downloadState&&y.push(this.K.downloadState);this.K.userState&&y.push.apply(y,g.hH((new ZRG(this.K.userState)).W()));this.K.additionalMetadata&&y.push.apply(y,g.hH((new Wkh(this.K.additionalMetadata)).W()));return[].concat(g.hH(new Set(y)))};
g.x(EKn,I7);EKn.prototype.W=function(){var y=[];this.K.userChannelDetails&&y.push(this.K.userChannelDetails);return[].concat(g.hH(new Set(y)))};
g.x(keG,I7);keG.prototype.W=function(){var y=[];this.K.channelOwner&&y.push(this.K.channelOwner);this.K.playbackPosition&&y.push(this.K.playbackPosition);this.K.localImageEntities&&y.push.apply(y,g.hH(this.K.localImageEntities));this.K.downloadStatus&&y.push(this.K.downloadStatus);return[].concat(g.hH(new Set(y)))};
g.x(Lkn,I7);Lkn.prototype.W=function(){return[]};
g.x(a7h,I7);a7h.prototype.W=function(){return[]};
g.x(NDS,I7);NDS.prototype.W=function(){return[]};
g.x(SNG,I7);SNG.prototype.W=function(){return[]};
g.x(HRk,I7);HRk.prototype.W=function(){return[]};
g.x(Rh_,I7);Rh_.prototype.W=function(){return[]};
g.x(s_q,I7);s_q.prototype.W=function(){return[]};
g.x(MPu,I7);MPu.prototype.W=function(){return[]};
g.x(l7k,I7);l7k.prototype.W=function(){return[]};
g.x(zhm,I7);zhm.prototype.W=function(){return[]};
g.x(DSw,I7);DSw.prototype.W=function(){return[]};
g.x(uGX,I7);uGX.prototype.W=function(){return[]};
g.x(I7q,I7);I7q.prototype.W=function(){var y=[];this.K.trackDownloadMetadatas&&y.push.apply(y,g.hH(this.K.trackDownloadMetadatas));return[].concat(g.hH(new Set(y)))};
g.x(nKw,I7);
nKw.prototype.W=function(){var y=[];this.K.downloadedTracks&&y.push.apply(y,g.hH(this.K.downloadedTracks));this.K.smartDownloadedTracks&&y.push.apply(y,g.hH(this.K.smartDownloadedTracks));this.K.downloadedEpisodes&&y.push.apply(y,g.hH(this.K.downloadedEpisodes));this.K.downloadedAlbumReleases&&y.push.apply(y,g.hH(this.K.downloadedAlbumReleases));this.K.smartDownloadedAlbumReleases&&y.push.apply(y,g.hH(this.K.smartDownloadedAlbumReleases));this.K.downloadedPlaylists&&y.push.apply(y,g.hH(this.K.downloadedPlaylists));this.K.smartDownloadedPlaylists&&
y.push.apply(y,g.hH(this.K.smartDownloadedPlaylists));this.K.metadataOnlyTracks&&y.push.apply(y,g.hH(this.K.metadataOnlyTracks));return[].concat(g.hH(new Set(y)))};
g.x(gKh,I7);gKh.prototype.W=function(){var y=[];this.K.trackDownloadMetadatas&&y.push.apply(y,g.hH(this.K.trackDownloadMetadatas));return[].concat(g.hH(new Set(y)))};
g.x(cjG,I7);cjG.prototype.W=function(){var y=[];this.K.playbackData&&y.push(this.K.playbackData);this.K.localImageEntities&&y.push.apply(y,g.hH(this.K.localImageEntities));this.K.videoDownloadContextEntity&&y.push(this.K.videoDownloadContextEntity);return[].concat(g.hH(new Set(y)))};
g.x(USc,I7);USc.prototype.W=function(){var y=[];this.K.musicLibraryStatusEntity&&y.push(this.K.musicLibraryStatusEntity);this.K.primaryArtists&&y.push.apply(y,g.hH(this.K.primaryArtists));this.K.details&&y.push(this.K.details);this.K.userDetails&&y.push(this.K.userDetails);this.K.tracks&&y.push.apply(y,g.hH(this.K.tracks));this.K.share&&y.push(this.K.share);this.K.downloadMetadata&&y.push(this.K.downloadMetadata);this.K.refresh&&y.push(this.K.refresh);return[].concat(g.hH(new Set(y)))};
g.x(rj_,I7);rj_.prototype.W=function(){var y=[];this.K.albumRelease&&y.push(this.K.albumRelease);this.K.tracks&&y.push.apply(y,g.hH(this.K.tracks));return[].concat(g.hH(new Set(y)))};
g.x(oKw,I7);oKw.prototype.W=function(){var y=[];this.K.albumRelease&&y.push(this.K.albumRelease);return[].concat(g.hH(new Set(y)))};
g.x(Aj_,I7);Aj_.prototype.W=function(){var y=[];this.K.details&&y.push(this.K.details);this.K.userDetails&&y.push(this.K.userDetails);return[].concat(g.hH(new Set(y)))};
g.x(ehw,I7);ehw.prototype.W=function(){var y=[];this.K.parentArtist&&y.push(this.K.parentArtist);return[].concat(g.hH(new Set(y)))};
g.x(BD_,I7);BD_.prototype.W=function(){var y=[];this.K.parentArtist&&y.push(this.K.parentArtist);return[].concat(g.hH(new Set(y)))};
g.x(Geq,I7);Geq.prototype.W=function(){return[]};
g.x(P3C,I7);P3C.prototype.W=function(){return[]};
g.x(iRe,ui);iRe.prototype.W=function(){var y=[];this.K.creatorEntity&&y.push(this.K.creatorEntity);return[].concat(g.hH(new Set(y)))};
g.x(XPm,I7);
XPm.prototype.W=function(){var y=[];this.K.tracks&&y.push.apply(y,g.hH(this.K.tracks));this.K.refresh&&y.push(this.K.refresh);this.K.musicLibraryStatusEntity&&y.push(this.K.musicLibraryStatusEntity);this.K.details&&y.push(this.K.details);this.K.downloadMetadata&&y.push(this.K.downloadMetadata);this.K.sideloadMetadata&&y.push(this.K.sideloadMetadata);this.K.userDetails&&y.push(this.K.userDetails);this.K.entryCollection&&y.push(this.K.entryCollection);this.K.share&&y.push(this.K.share);this.K.podcastShowAdditionalMetadata&&
y.push.apply(y,g.hH((new iRe(this.K.podcastShowAdditionalMetadata)).W()));return[].concat(g.hH(new Set(y)))};
g.x(mSw,I7);mSw.prototype.W=function(){return[]};
g.x(C3k,I7);
C3k.prototype.W=function(){var y=[];this.K.musicLibraryStatusEntity&&y.push(this.K.musicLibraryStatusEntity);this.K.artists&&y.push.apply(y,g.hH(this.K.artists));this.K.audioModeVersion&&y.push(this.K.audioModeVersion);this.K.videoModeVersion&&y.push(this.K.videoModeVersion);this.K.userDetails&&y.push(this.K.userDetails);this.K.details&&y.push(this.K.details);this.K.albumRelease&&y.push(this.K.albumRelease);this.K.share&&y.push(this.K.share);this.K.libraryEdit&&y.push(this.K.libraryEdit);this.K.downloadMetadata&&
y.push(this.K.downloadMetadata);this.K.playbackPosition&&y.push(this.K.playbackPosition);this.K.lyrics&&y.push(this.K.lyrics);return[].concat(g.hH(new Set(y)))};
g.x(y9h,I7);y9h.prototype.W=function(){var y=[];this.K.parentTrack&&y.push(this.K.parentTrack);return[].concat(g.hH(new Set(y)))};
g.x(qnm,I7);qnm.prototype.W=function(){var y=[];this.K.parentTrack&&y.push(this.K.parentTrack);return[].concat(g.hH(new Set(y)))};
g.x(jw_,I7);jw_.prototype.W=function(){return[]};
g.x(Qww,I7);Qww.prototype.W=function(){return[]};
g.x(pqh,I7);pqh.prototype.W=function(){return[]};
g.x(vvm,I7);vvm.prototype.W=function(){return[]};
g.x(dNc,I7);dNc.prototype.W=function(){var y=[];this.K.transfer&&y.push(this.K.transfer);this.K.adsPlaybackData&&y.push.apply(y,g.hH(this.K.adsPlaybackData));this.K.drmLicense&&y.push(this.K.drmLicense);this.K.offlineVideoPolicy&&y.push(this.K.offlineVideoPolicy);this.K.videoDownloadContextEntity&&y.push(this.K.videoDownloadContextEntity);return[].concat(g.hH(new Set(y)))};
g.x(Tom,I7);Tom.prototype.W=function(){return[]};
g.x(Vtw,I7);Vtw.prototype.W=function(){var y=[];this.K.offlineVideoStreams&&y.push.apply(y,g.hH(this.K.offlineVideoStreams));this.K.captionTrack&&y.push.apply(y,g.hH(this.K.captionTrack));return[].concat(g.hH(new Set(y)))};
g.x(Oye,I7);Oye.prototype.W=function(){return[]};
g.x(wqG,I7);wqG.prototype.W=function(){return[]};
g.x(J9X,I7);J9X.prototype.W=function(){return[]};
g.x(Ffn,I7);Ffn.prototype.W=function(){return[]};
g.x(Yn_,I7);Yn_.prototype.W=function(){return[]};
g.x(fjc,I7);fjc.prototype.W=function(){return[]};
g.x(hQG,I7);hQG.prototype.W=function(){return[]};
g.x(bye,I7);bye.prototype.W=function(){return[]};
g.x($N_,I7);$N_.prototype.W=function(){return[]};
g.x(Kf_,I7);Kf_.prototype.W=function(){return[]};
g.x(xNh,I7);xNh.prototype.W=function(){return[]};
g.x(WfS,I7);WfS.prototype.W=function(){return[]};
g.x(ZyS,I7);ZyS.prototype.W=function(){return[]};
g.x(ttu,I7);ttu.prototype.W=function(){return[]};
g.x(Evn,I7);Evn.prototype.W=function(){return[]};
g.x(kDw,I7);kDw.prototype.W=function(){return[]};
g.x(LfG,I7);LfG.prototype.W=function(){return[]};
g.x(aj_,I7);aj_.prototype.W=function(){return[]};
g.x(Non,I7);Non.prototype.W=function(){return[]};
g.x(Sn_,I7);Sn_.prototype.W=function(){return[]};
g.x(Hym,I7);Hym.prototype.W=function(){return[]};
g.x(RQm,I7);RQm.prototype.W=function(){return[]};
var HXq=["browse","music/browse","unplugged/browse"],zeG=["offline/playlist_sync_check"],Wue=["offline"],Rec=["offline/offline_video_playback_position_sync"],MxS=["offline/get_playback_data_entity"],ne;g8.getInstance=function(){return g.M(function(y){return y.return(new Promise(function(q){g.y1().then(function(Q){Q?(g8.instance||(g8.instance=new g8(Q)),q(g8.instance)):q(void 0)})}))})};
g8.prototype.get=function(y){var q=this,Q,p,v;return g.M(function(d){if(d.K==1)return g.R(d,zQS(q.token),2);if(d.K!=3)return Q=d.W,g.R(d,Q.get("prefs",y),3);p=d.W;if(!p)return d.return();v=(0,g.SK)();return p.expirationTimestampMs<=v?d.return():d.return(p.value)})};
g8.prototype.set=function(y,q,Q){Q=Q===void 0?31536E3:Q;var p=this,v,d,T;return g.M(function(O){if(O.K==1)return v=(0,g.SK)(),d={key:y,value:q,expirationTimestampMs:v+Q*1E3},g.R(O,zQS(p.token),2);T=O.W;return g.R(O,g.DG(T,"prefs",d),0)})};
g8.prototype.remove=function(y){var q=this,Q;return g.M(function(p){if(p.K==1)return g.R(p,zQS(q.token),2);Q=p.W;return g.R(p,Q.delete("prefs",y),0)})};
g.x(c7,g.GH);g.x(UO,gvu);UO.prototype.N=function(y,q){q=UNc(q);y=(new TextEncoder).encode(JSON.stringify(y));return this.K.encrypt(y,q)};
UO.prototype.W=function(y,q){if(!(y instanceof Uint8Array))throw DNC(1);var Q=new TextDecoder;q=UNc(q);y=this.K.decrypt(y,q);return JSON.parse(Q.decode(y))};
var r9S={accountLinkStatusEntity:qNe,booleanEntity:ebk,buttonEntity:Evn,captionTrack:jw_,channelHandle:rvc,chipEntity:hQG,commerceAcquisitionClientPayloadEntity:LfG,commerceCartListEntity:aj_,contextNoteFeedEntityPayload:oU_,contextNoteUserRatingEntityPayload:Av_,continuationTokenEntity:bRu,downloadQualityPickerEntity:vKX,downloadsPageRefreshTokenEntity:TDC,downloadsPageViewConfigurationEntity:Lkn,downloadStatusEntity:dSh,dismissState:bye,sfvAudioItemCurrentlyPlayingEntity:Ffn,emojiFountainDataEntity:ZyS,
emojiCustomizationSetEntity:WfS,fakeChannel:Gyh,fakePlaylist:Pmm,fakePlaylistEntryCollection:X2k,fakeVideo:mam,fakeVideoDescription:Cmw,featuredProductsEntity:zhm,flowStateEntity:yj_,iconBadgeEntity:Non,interstitialInteractionStateEntity:Q_C,likeButtonAnimationEntity:a7h,liveChatPollStateEntity:pP_,dataFreshnessEntity:xNh,liveViewerLeaderboardChatEntryPointStateEntity:wqG,liveViewerLeaderboardPointsEntity:J9X,liveReactionsDataEntity:ttu,logoEntity:j_m,macroMarkerEntity:NDS,mainDownloadsLibraryEntity:VPm,
mainDownloadsListEntity:wPC,mainPlaylistDownloadStateEntity:Jjq,mainPlaylistEntity:$Sn,mainPlaylistVideoEntity:Kkm,mainVideoDownloadStateEntity:Fk_,mainVideoEntity:tPm,markersEngagementPanelSyncEntity:SNG,markersVisibilityOverrideEntity:HRk,musicAlbumReleaseDetail:rj_,musicAlbumReleaseDownloadMetadataEntity:I7q,musicAlbumRelease:USc,musicAlbumReleaseUserDetail:oKw,musicArtistDetail:ehw,musicArtist:Aj_,musicArtistUserDetail:BD_,musicDownloadsLibraryEntity:nKw,musicLibraryEdit:Geq,musicLibraryStatusEntity:P3C,
musicPlaylist:XPm,musicPlaylistDownloadMetadataEntity:gKh,musicShare:mSw,musicTrackDetail:y9h,musicTrackDownloadMetadataEntity:cjG,musicTrack:C3k,musicTrackUserDetail:qnm,offlineOrchestrationActionWrapperEntity:Qww,offlineVideoPolicy:pqh,offlineVideoStreams:vvm,offlineabilityEntity:YNe,orchestrationWebSamplingEntity:f7G,pageHeaderEntity:$N_,pdpStateEntity:Sn_,pinnedProductEntity:DSw,playbackData:dNc,playerStateEntity:Rh_,quantityIncrementerEntity:Hym,refresh:Tom,saveToPlaylistListEntity:Yn_,selectedChipIndexEntityPayload:s_q,
settingEntity:fjc,stringEntity:Brc,suggestedFeedbackChipStateEntity:MPu,transfer:Vtw,trendingOfferEntity:uGX,videoDownloadContextEntity:Oye,videoOverviewAsyncDataEntity:RQm,videoPlaybackPositionEntity:kDw,votingEntity:Kf_,ytMainChannelEntity:EKn,youchatPendingResponseEntity:l7k,ytMainDownloadedVideoEntity:hhX,ytMainVideoEntity:keG};g.x(GF,gvu);GF.prototype.N=function(y){return y};
GF.prototype.W=function(y){if(y instanceof Uint8Array)throw DNC(0);return y};
g.x(P7,g.I);P7.prototype.observe=function(y){var q=this;this.observers.push(y);return function(){var Q=q.observers.indexOf(y);Q>=0&&q.observers.splice(Q,1)}};
P7.prototype.W=function(y){QTc(this,y.data)};
P7.prototype.FV=function(){this.channel.close()};
var VTn,dnS=new g.R3("elementsCommand");var kL=new g.R3("entityBatchUpdate");var GQX=new g.R3("downloadStatusEntity");var OEk=new g.R3("mainPlaylistEntityActionMetadata");var iY=new g.R3("mainVideoEntityActionMetadata");var xn_=new g.R3("musicPlaylistEntityActionMetadata");var o2_=new g.R3("musicTrackEntityActionMetadata");var kcc=new g.R3("localImageEntityActionMetadata");var DS=new g.R3("playbackDataActionMetadata");var dMh=new g.R3("transferEntityActionMetadata");var een=new g.R3("videoPlaybackPositionEntityActionMetadata");var E9X;new g.$9;new g.$9;SIe.prototype.request=function(y,q,Q){q=q===void 0?{}:q;return this.locks.request(y,q,function(p){return Q(p)})};var Q4=g.CS.caches,jN,lMm;qh.prototype.open=function(y){return Q4.open(sTX(y))};
qh.prototype.has=function(y){return Q4.has(sTX(y))};
qh.prototype.delete=function(y){return Q4.delete(sTX(y))};
qh.prototype.match=function(y,q){var Q=this,p,v,d,T,O,w;return g.M(function(J){switch(J.K){case 1:return g.R(J,Q.keys(),2);case 2:p=J.W,v=g.t(p),d=v.next();case 3:if(d.done){J.ej(5);break}T=d.value;return g.R(J,Q.open(T),6);case 6:return O=J.W,g.R(J,O.match(y,q),7);case 7:if(w=J.W)return J.return(w);d=v.next();J.ej(3);break;case 5:return J.return()}})};
g.x(RLh,qh);RLh.prototype.keys=function(){var y,q,Q,p,v,d,T,O,w;return g.M(function(J){if(J.K==1)return y=[],q=g.Pn("CacheStorage keys"),g.R(J,Q4.keys(),2);Q=J.W;p=g.t(Q);for(v=p.next();!v.done;v=p.next()){d=v.value;var F=d.indexOf(":");T=F===-1?{A2:d}:{A2:d.substring(0,F),datasyncId:d.substring(F+1)};O=T.A2;w=T.datasyncId;w===q&&y.push(O)}return J.return(y)})};g.x(vR,g.I);vR.prototype.N=function(y){this.api.AK("onOfflineOperationFailure",y.data)};
vR.prototype.Y=function(y){this.api.publish("offlinetransferpause",y.data)};
vR.prototype.FV=function(){var y;(y=this.K)==null||y.close();var q;(q=this.W)==null||q.close()};uoe.prototype.ol=function(){this.K&&TC(this)};
uoe.prototype.Qz=function(){this.W&&this.W.resolve();this.N=this.K=!1;this.j()};var t4_=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Qpm="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var feX="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.x(u4X,Mh);u4X.prototype.W=function(y){return Ju(y)?g0c(this,y):FS(y)?rAX(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};g.x(o0m,Mh);o0m.prototype.W=function(y){return FS(y)?AAS(this,y):BNX(y)?BPS(this,y):YL(y)?Go_(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};g.K=P6S.prototype;g.K.H3b=function(y){var q=this,Q,p,v,d;return g.M(function(T){if(!g.G(y.state,128))return T.ej(0);Q=y.state.kJ;var O=(p=Q)==null?void 0:p.errorCode,w=(v=Q)==null?void 0:v.rA;d=O==="net.connect"&&w===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(O==null?0:O.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.R(T,q.Bd(q.player.getVideoData().videoId,d),0)})};
g.K.Bd=function(y,q){var Q=this;return g.M(function(p){if(p.K==1){if(Q.W)return p.return();Q.W=!0;return q==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(nT(Q,y,!1,!0),p.ej(0)):g.R(p,Iv(Q,y),3)}g.wx(y,4);return g.R(p,Q.K.Bd(q),0)})};
g.K.X6=function(y){y.status===2?(y.status!==this.N&&(oyc(this.K),g.wx(y.videoId,2)),y.xm&&PxS(this.K,y.videoId,y.xm)):y.status===4?(Iv(this,y.videoId),this.Bd(y.videoId,y.eC?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):y.status===1&&G9u(this.K);this.N=y.status;this.api.AK("localmediachange",{videoId:y.videoId,status:y.status})};
g.K.fp=function(){var y=this,q;return g.M(function(Q){if(Q.K==1){if(y.W)return Q.return();y.W=!0;q=y.player.getVideoData().videoId;return g.R(Q,Iv(y,q),2)}return g.R(Q,y.K.fp(),0)})};
g.K.xP=function(y){switch(y){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.K.L=function(y){return this.api.T().L(y)};g.x(q$q,Mh);q$q.prototype.W=function(y){return Ju(y)?Q4k(this,y):FS(y)?pOw(this,y):BNX(y)?vy_(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};Jru.prototype.K=function(y,q){var Q=y.action.actionMetadata.priority-q.action.actionMetadata.priority;Q===0&&(y.K<q.K?Q=-1:y.K>q.K&&(Q=1));return Q};g.x(gE,g.I);gE.prototype.FV=function(){this.j&&this.j();g.I.prototype.FV.call(this)};
gE.prototype.createAction=function(y,q){var Q=g.QX(y.entityKey).entityType,p=g.ZX(16);return new KT(Q,p,y,q.actionId,q.rootActionId)};
gE.prototype.N$=function(y){var q=this,Q,p,v,d,T,O,w,J,F;return g.M(function(Y){if(Y.K==1){if(q.iB())return Y.return();p=(Q=y.offlineOrchestrationActionWrapperEntity)!=null?Q:new Set;v=[];d=g.t(p);for(T=d.next();!T.done;T=d.next())O=T.value,w=g.QX(O),J=w.entityId,ffm(q.K,J)||v.push(O);return g.R(Y,LOm(q,v),2)}F=Y.W;return g.R(Y,k9m(q,F),0)})};
gE.prototype.retry=function(){var y=this;return g.M(function(q){return g.R(q,afh(y),0)})};S$c.prototype.zL=function(y,q){q=q===void 0?!0:q;var Q=this,p,v,d,T,O,w,J,F;return g.M(function(Y){switch(Y.K){case 1:if(!Q.K)return Y.return();p=[];v=g.pC(Q.K.W,q);d=[];for(T={mK:0};T.mK<v.length;T={mK:T.mK},T.mK++)O=v[T.mK],w=Q.K.vM(O,"json3"),J=g.lb(w,{withCredentials:!0,format:"RAW"},3,500).then(function(f){return function(h){h={metadata:g.Pr(v[f.mK]),trackData:h.xhr.responseText};d.push(h)}}(T)).IE(function(f){pT("Caption fetch error",f)}),p.push(J);
return g.R(Y,Uac(p),2);case 2:return g.EC(Y,3),g.R(Y,bGn(y,d),5);case 5:g.Hp(Y,0);break;case 3:F=g.Rj(Y),pT("Caption DB transaction error",F),g.tH(Y)}})};g.x(cR,g.I);cR.prototype.FV=function(){this.W&&this.W();g.I.prototype.FV.call(this)};
cR.prototype.N=function(y){var q=this,Q,p,v,d,T,O,w,J;return g.M(function(F){p=(Q=y.transfer)!=null?Q:new Set;v=[];d=g.t(p);for(T=d.next();!T.done;T=d.next())O=T.value,w=g.QX(O),J=w.entityId,v.push(J);return v.length===0?F.return():g.R(F,s4h(q,v),0)})};g.x(unm,g.I);g.K=unm.prototype;g.K.FV=function(){this.m3&&this.m3();this.Sj.dispose();this.Y.dispose();this.vI&&g.jt(this.G.cA,this.vI);this.Es&&g.jt(this.G.cA,this.Es);g.I.prototype.FV.call(this)};
g.K.y1V=function(y){var q=this,Q,p,v;return g.M(function(d){switch(d.K){case 1:Q=g.po(y,"transfer");if(q.K&&Q===q.K.key){nT(q.X,q.J,!0);q.Y.stop();d.ej(0);break}return g.R(d,ii(q.W,{mode:"readwrite",ij:!0},function(T){return r8(T,Q,"transfer").then(function(O){if(O&&O.transferState!=="TRANSFER_STATE_COMPLETE"&&O.transferState!=="TRANSFER_STATE_FAILED")return O.transferState="TRANSFER_STATE_PAUSED_BY_USER",eq(T,O,"transfer").then(function(){return O})})}),3);
case 3:p=d.W;if(!p){d.ej(0);break}if(!y||!q.N){d.ej(5);break}return g.R(d,fT(y,q.N,q.W,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.R(d,ov(q,y),7);case 7:v=d.W,ASG({videoId:y,Hx:p,offlineModeType:v}),g.tH(d)}})};
g.K.gkK=function(){var y=this;if(this.K&&this.J){nT(this.X,this.J,!1);var q=this.K,Q=(q==null?0:q.key)?g.QX(q.key).entityId:"";Q&&this.N&&(new Promise(function(p,v){fT(Q,y.N,y.W,"DOWNLOAD_STATE_PAUSED").catch(function(d){v(d)})})).catch(function(p){pT("Download state setting error",p)})}this.Y.stop()};
g.K.wb=function(){this.K?gyC(this,this.K):rE(this)};
g.K.ZH=function(y){var q=this;return g.M(function(Q){switch(Q.K){case 1:if(!q.K){Q.ej(2);break}if(q.K.transferState==="TRANSFER_STATE_COMPLETE"||q.K.transferState==="TRANSFER_STATE_FAILED"||!y.transfer||!y.transfer.has(q.K.key)){Q.ej(3);break}return g.R(Q,mp(q.W,q.K.key,"transfer"),4);case 4:q.K=Q.W;if(q.K){Q.ej(3);break}return g.R(Q,crc(q),3);case 3:if(q.K)return Q.return();case 2:return g.R(Q,rE(q),0)}})};
g.K.Bd=function(y,q){var Q=this,p,v,d,T,O;return g.M(function(w){switch(w.K){case 1:if(!Q.K){Au(Q,"onTransferFailure: "+y);w.ej(2);break}p=Q.K;d=((v=p)==null?0:v.key)?g.QX(p.key).entityId:"";a:switch(y){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var J=!1;break a;default:J=!0}return J&&iUh(Q)?g.R(w,eN(Q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.R(w,
XOX(Q,y),5);case 5:if(!d||!Q.N){w.ej(2);break}return g.R(w,fT(d,Q.N,Q.W,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.R(w,ov(Q,d),9);case 9:T=w.W;OF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:d,Hx:p,offlineModeType:T});if(!d||!Q.N){w.ej(2);break}return g.R(w,fT(d,Q.N,Q.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:UF(Q),O=rE(Q,!0),q&&q(O),g.tH(w)}})};
g.K.fp=function(y){var q=this,Q,p,v,d,T,O,w,J,F,Y,f,h;return g.M(function(b){switch(b.K){case 1:if(!q.K){Au(q,"onMaybeTransferStreamsExpired");b.ej(2);break}return iUh(q)?g.R(b,eN(q,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.R(b,XOX(q,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!q.N){b.ej(2);break}Q=q.K;v=((p=Q)==null?0:p.key)?g.QX(Q.key).entityId:"";if(!v){b.ej(2);break}return g.R(b,fT(v,q.N,q.W,"DOWNLOAD_STATE_FAILED"),2);case 9:return q.K||Au(q,"onMaybeTransferStreamsExpiredRetryAttempting"),
d=q.K,O=((T=d)==null?0:T.key)?g.QX(d.key).entityId:"",g.R(b,ov(q,O),10);case 10:return w=b.W,OF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:O,Hx:d,offlineModeType:w}),J=Xwm(),g.gy(J,DS,{isEnqueuedForExpiredStreamUrlRefetch:!0}),F=g.po(O,"playbackData"),Y={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:F,actionMetadata:J},f=WR(new KT("playbackData",O,Y)),g.R(b,XC(q.W,f,"offlineOrchestrationActionWrapperEntity"),2);case 2:UF(q),h=rE(q,!0),
y&&y(h),g.tH(b)}})};
var qxc={},mMm=(qxc.TRANSFER_STATE_TRANSFERRING=1,qxc.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,qxc);g.K=BR.prototype;g.K.kI=function(){return this.J.promise};
g.K.Wo=function(){if(this.W&&this.X)return this.J.promise;qew(this).then(this.J.resolve).catch(this.J.reject);return this.J.promise};
g.K.QX=function(y){var q={};return q.playbackData=new u4X(y,this.KK,this.K),q.transfer=new q$q(y,this.KK),q.videoPlaybackPositionEntity=new o0m(y,this.KK),q};
g.K.J3=function(){var y=this;return g.M(function(q){return y.W?g.R(q,Ifm(y.W),0):q.ej(0)})};
g.K.YF=function(){var y=this,q,Q;return g.M(function(p){if(p.K==1)return y.W||y.X?g.R(p,y.kI(),2):p.return();y.C!==void 0&&(g.tM(y.C),y.C=void 0);y.Y!==void 0&&(g.tM(y.Y),y.Y=void 0);(q=y.W)==null||q.dispose();y.W=void 0;(Q=y.X)==null||Q.dispose();y.X=void 0;y.api.AK("onOrchestrationLostLeader");y.J=new g.$9;g.tH(p)})};
g.K.isOrchestrationLeader=function(){return this.N.K};
g.K.Xe=function(){return g.M(function(y){return y.return(!1)})};
g.K.Vv=function(y){var q=this.K;q.api.publish("offlinetransferpause",y);var Q;(Q=q.W)==null||Q.postMessage(y)};
g.K.wb=function(y){var q,Q;return g.M(function(p){if(p.K==1)return g.R(p,y4(),2);q=p.W;if(!q)return p.return();Q=g.po(y,"transfer");return g.R(p,ii(q,{mode:"readwrite",ij:!0},function(v){var d=r8(v,Q,"transfer"),T=r8(v,g.po(y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.kC.all([d,T]).then(function(O){O=g.t(O);var w=O.next().value;var J=O.next().value;return w&&w.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",eq(v,w,"transfer").then(function(){OF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:y,Hx:w,offlineModeType:J==null?void 0:J.offlineModeType});return g.kC.resolve(null)})):g.kC.resolve(null)})}),0)})};
g.K.Pg=function(y){y=y===void 0?43200:y;var q=this,Q,p,v,d,T,O,w,J;return g.M(function(F){if(F.K==1)return q.G.rh()?g.R(F,y4(),2):F.return(j3k());if(F.K!=3){Q=F.W;if(!Q)return F.return([]);p=Date.now()/1E3;return g.R(F,Ce(Q,"offlineVideoPolicy"),3)}v=F.W;d=[];T=g.t(v);for(O=T.next();!O.done;O=T.next())w=O.value,Number(w.lastUpdatedTimestampSeconds)+y<=p&&(J=g.QX(w.key).entityId,d.push(J));return d.length?F.return(GC(q,d,q.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):F.return([])})};
g.K.deleteAll=function(){return GC(this,["!*$_ALL_ENTITIES_!*$"],this.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.K.refreshAllStaleEntities=function(y){var q=this;return g.M(function(Q){return Q.K==1?g.R(Q,q.Pg(y),2):Q.return(Q.W)})};
g.K.setUpPositionSyncInterval=function(y){var q=this;this.Y!==void 0&&(g.tM(this.Y),this.Y=void 0);var Q=y!=null?y:864E5;this.Y=g.WF(function(){q.NP(Q)},Q)};
g.K.NP=function(y){var q=this,Q,p,v,d,T,O;return g.M(function(w){switch(w.K){case 1:return g.EC(w,2),g.R(w,g8.getInstance(),4);case 4:Q=w.W;if(!Q)throw Error("prefStorage is undefined");return g.R(w,Q.get("psi"),5);case 5:p=w.W;d=((v=p)==null?0:v.f7)?Number(p.f7)/1E3:0;T=Date.now();if(!(d+y<=T)){w.ej(6);break}return g.R(w,GC(q,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Hp(w,0);break;case 2:O=g.Rj(w),pT("Offline manager error",O),
g.tH(w)}})};
g.K.ww=function(){var y=this,q,Q,p,v,d,T,O;return g.M(function(w){if(w.K==1)return g.R(w,y4(),2);if(w.K!=3)return(q=w.W)?g.R(w,Ce(q,"transfer"),3):w.return([]);Q=w.W;p=[];v=g.t(Q);for(d=v.next();!d.done;d=v.next())T=d.value,T.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&T.key&&(O=g.QX(T.key).entityId,p.push(O));return w.return(pAh(y,p))})};
g.K.YL=function(){return g.M(function(y){return y.return([])})};
g.K.wz=function(){return g.M(function(y){g.tH(y)})};
g.K.Hm=function(){return g.M(function(y){g.tH(y)})};g.x(v2n,Mh);v2n.prototype.W=function(y){return Ju(y)?VcC(this,y):FS(y)?wAw(this,y):YL(y)?Jt_(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};
var PR=[10];g.x(bEC,Mh);bEC.prototype.W=function(y){return Ju(y)?x$e(this,y):FS(y)?WJS(this,y):YL(y)?ZEC(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};
var KJG=[10];g.x(E2m,Mh);E2m.prototype.W=function(y){return FS(y)?LJ_(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};g.x(a9k,BR);g.K=a9k.prototype;g.K.QX=function(y){var q=BR.prototype.QX.call(this,y);q.mainVideoEntity=new bEC(y,this.KK,this.K);q.mainPlaylistEntity=new v2n(y,this.KK,this.K);q.mainDownloadsListEntity=new E2m(y,this.KK,this.K);return q};
g.K.refreshAllStaleEntities=function(y,q){var Q=this,p,v,d,T,O,w,J,F,Y,f,h;return g.M(function(b){switch(b.K){case 1:p=[];if(!Q.KK.L("web_player_offline_playlist_auto_refresh")){b.ej(2);break}return g.R(b,NXc(Q,y,q),3);case 3:p=b.W;case 2:return g.R(b,g8.getInstance(),4);case 4:return v=b.W,g.R(b,(d=v)==null?void 0:d.get("sdois"),5);case 5:return T=b.W,g.R(b,(O=v)==null?void 0:O.get("lmqf"),6);case 6:w=b.W;if(!T){b.ej(7);break}F=p;Y=F.concat;return g.R(b,SeC(Q,T,(J=w)!=null?J:"SD",y===0),8);case 8:p=
Y.call(F,b.W);case 7:return f=p,h=f.concat,g.R(b,BR.prototype.refreshAllStaleEntities.call(Q,y,q),9);case 9:return p=h.call(f,b.W),b.return(p)}})};
g.K.Xe=function(y){var q,Q,p,v,d,T,O,w;return g.M(function(J){if(J.K==1)return g.R(J,y4(),2);if(J.K!=3)return(q=J.W)?g.R(J,mp(q,g.uT,"mainDownloadsListEntity"),3):J.return(!1);Q=J.W;if((p=Q)==null?0:(v=p.downloads)==null?0:v.length)for(d=g.po(y,"mainVideoEntity"),T=g.t(Q.downloads),O=T.next();!O.done;O=T.next())if(w=O.value,w.videoItem===d)return J.return(!0);return J.return(!1)})};
g.K.YL=function(){var y=this,q,Q,p,v,d,T,O,w;return g.M(function(J){if(J.K==1)return g.R(J,y4(),2);if(J.K!=3)return(q=J.W)?g.R(J,Ce(q,"downloadStatusEntity"),3):J.return([]);Q=J.W;p=[];v=g.t(Q);for(d=v.next();!d.done;d=v.next())T=d.value,T.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&T.key&&(O=g.QX(T.key).entityId,p.push(O));return p.length?(w={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},J.return(GC(y,p,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
w))):J.return([])})};
g.K.Hm=function(){var y;return g.M(function(q){return q.K==1?g.R(q,y4(),2):(y=q.W)?g.R(q,ii(y,{mode:"readwrite",ij:!0},function(Q){return o7(Q,"mainVideoEntity").then(function(p){var v=[];p=g.t(p);for(var d=p.next();!d.done;d=p.next()){d=d.value;var T=void 0;(T=d.userState)!=null&&T.playbackPosition||(T=g.QX(d.key).entityId,T={key:g.po(T,"videoPlaybackPositionEntity"),videoId:T,lastPlaybackPositionSeconds:"0"},v.push(eq(Q,T,"videoPlaybackPositionEntity")),d.userState={playbackPosition:T.key},v.push(eq(Q,
d,"mainVideoEntity")))}return g.kC.all(v)})}),0):q.return()})};
g.K.wz=function(){var y,q,Q,p,v,d,T,O,w,J,F,Y,f,h,b,Z,k,S,N,l,u,c,X,A,Tf,OC,pS,YD,q9,aj,Pp,Fc,Jm,gg,M9,pM,DC,on;return g.M(function(Oo){if(Oo.K==1)return g.R(Oo,y4(),2);if(Oo.K!=3){y=Oo.W;if(!y)return Oo.return();q=g.po("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.R(Oo,ii(y,{mode:"readonly",ij:!0},function(H){return g.kC.all([r8(H,q,"mainDownloadsListEntity"),r8(H,g.uT,"mainDownloadsListEntity"),o7(H,"mainVideoEntity"),o7(H,"mainPlaylistEntity")])}),3)}Q=Oo.W;
p=g.t(Q);v=p.next().value;d=p.next().value;T=p.next().value;O=p.next().value;w=v;J=d;F=T;Y=O;f=new Set;if((h=w)==null?0:(b=h.downloads)==null?0:b.length)for(Z=g.t(w.downloads),k=Z.next();!k.done;k=Z.next())S=k.value,N=void 0,(l=(N=S.videoItem)!=null?N:S.playlistItem)&&f.add(l);if((u=J)==null?0:(c=u.downloads)==null?0:c.length)for(X=g.t(J.downloads),A=X.next();!A.done;A=X.next())Tf=A.value,Tf.videoItem&&f.add(Tf.videoItem);OC=new Set;pS=[];YD=g.t(Y);for(q9=YD.next();!q9.done;q9=YD.next()){aj=q9.value;
if(aj.videos)for(Pp=g.t(aj.videos),Fc=Pp.next();!Fc.done;Fc=Pp.next())Jm=Fc.value,(gg=JSON.parse(g.QX(Jm).entityId).videoId)&&OC.add(gg);aj.key&&!f.has(aj.key)&&pS.push(aj.key)}M9=g.t(F);for(pM=M9.next();!pM.done;pM=M9.next())DC=pM.value,DC.key&&!f.has(DC.key)&&(on=g.QX(DC.key).entityId,OC.has(on)||pS.push(DC.key));return pS.length?g.R(Oo,wHn(y,pS),0):Oo.ej(0)})};g.x(HE_,Mh);HE_.prototype.W=function(y){return Ju(y)?s3h(this,y):FS(y)?Mcn(this,y):YL(y)?l9w(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};
var XS=[10];g.x(D$k,Mh);D$k.prototype.W=function(y){return Ju(y)?I9q(this,y):FS(y)?n2u(this,y):YL(y)?g2_(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};
var mB=[10];g.x(rtm,Mh);rtm.prototype.W=function(y){return Ju(y)?BXh(this,y):FS(y)?Gcn(this,y):YL(y)?PpC(this,y):Promise.reject(Error("Unsupported action type: "+y.actionType))};
var epe=[10];g.x(CT,BR);CT.prototype.QX=function(y){var q=BR.prototype.QX.call(this,y);q.musicTrack=new rtm(y,this.K);q.musicPlaylist=new D$k(y,this.K);q.musicAlbumRelease=new HE_(y,this.K);return q};
CT.prototype.refreshAllStaleEntities=function(y,q){var Q=this,p,v,d;return g.M(function(T){if(T.K==1)return g.R(T,XA_(Q,y,q),2);if(T.K!=3)return v=p=T.W,d=v.concat,g.R(T,BR.prototype.refreshAllStaleEntities.call(Q,y,q),3);p=d.call(v,T.W);return T.return(p)})};g.x(m$S,g.LC);g.K=m$S.prototype;g.K.create=function(){var y=this;g.n(this,this.events);if(g.Nj(this.KK))this.K=new a9k(this.KK,this.player);else if(g.Us(this.KK)||g.Hr(this.KK))this.K=new CT(this.KK,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){y.LA()});
this.events.Z(this.player,"videodatachange",function(){y.LA()});
this.KK.L("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.wf)};
g.K.VD=function(){return!1};
g.K.Hv=function(y,q,Q,p){var v=this;return g.M(function(d){return v.K?d.return(GC(v.K,y,q,Q,p)):d.return(Promise.reject())})};
g.K.deleteAll=function(){return this.K.deleteAll()};
g.K.Pg=function(y){return this.K.Pg(y)};
g.K.refreshAllStaleEntities=function(y){return this.K.refreshAllStaleEntities(y)};
g.K.setUpPositionSyncInterval=function(y){this.K.setUpPositionSyncInterval(y)};
g.K.Vv=function(y){this.K.Vv(y)};
g.K.wb=function(y){return this.K.wb(y)};
g.K.LA=function(){var y=this,q;return g.M(function(Q){q=y.player.getVideoData();return g.E7(q)?Cp_(q)&&y.W!==q.clientPlaybackNonce?g.R(Q,yMS(y,q),0):Q.ej(0):Q.return()})};
g.K.wf=function(y){var q=this,Q,p,v,d,T,O,w;return g.M(function(J){if(J.K==1)return Q=q.player.getVideoData(),p=Q.ra,g.Ks(y,2)||g.Ks(y,512)?g.R(J,y4(),2):J.return();if(J.K!=3){v=J.W;if(!v)return pT("PES is undefined"),J.return();d=Q.videoId;return g.R(J,mp(v,g.po(d,"mainVideoEntity"),"mainVideoEntity"),3)}T=J.W;if(!T)return J.return();O=Math.floor(p).toString();w={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:O}};return g.R(J,q.Hv([d],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
w),0)})};
g.K.isOrchestrationLeader=function(){return this.K.isOrchestrationLeader()};
g.K.updateDownloadState=function(y,q){var Q,p,v,d;return g.M(function(T){if(T.K==1)return g.R(T,y4(),2);Q=T.W;if(!Q)return pT("PES is undefined"),T.return();p=g.QX(y);v=p.entityType;d=p.entityId;return g.R(T,fT(d,v,Q,q,!0),0)})};g.k1("offline",m$S);})(_yt_player);
